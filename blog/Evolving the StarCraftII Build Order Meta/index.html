<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="zh-CN">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US" class="js">
<!--<![endif]-->
  

	
	    
	        
	    
	        
	    
	        
	    
	    
	

	
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	
<head>
	<meta charset="utf-8">
	<title>Evolving the StarCraftII Build Order Meta | Online Profile</title>
	<meta name="description" content=", python, tensorflow, rnn, EDA, Data Munging, Deep Learning, flask, d3.js, IntroductionGoogle&#39;s Artificial Intelligence research group, DeepMind recently released a python API, pySC2 for the popular Real Time Strategy (RTS) comp...">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-Frame-Options" content="sameorigin">
	<!-- CSS -->
	<link rel="stylesheet" href="/css/main.css">
	<link rel='stylesheet' id='divi-style-css'  href="/css/style.css" type='text/css' media='all' />
	<link rel="stylesheet" href="/css/post.style.css">
	<link rel="stylesheet" href="/css/highlight.css">

	<script type='text/javascript' src="/js/jquery.js"></script>
	<script type='text/javascript' src="/js/soundmanager2-nodebug-jsmin.js"></script>

	<!--Favicon-->
	<link rel="icon" href="favicon.ico" type="image/x-icon"/>
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	
	<link href="/favicon.ico" mce_href="favicon.ico" rel="bookmark" type="image/x-icon" /> 
	<link href="/favicon.ico" mce_href="favicon.ico" rel="icon" type="image/x-icon" /> 
	<link href="/favicon.ico" mce_href="favicon.ico" rel="shortcut icon" type="image/x-icon" /> 
	<!-- Canonical -->
	<link rel="canonical" href="http://cole-maclean.github.io//blog/Evolving%20the%20StarCraftII%20Build%20Order%20Meta/">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Online Profile" href="http://cole-maclean.github.io//feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	

	<!-- KaTeX -->
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.js"></script>
	

	<!-- Google Analytics -->
	
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-71787228-1', 'auto');
	ga('send', 'pageview');
	</script>
	

	<script type="text/javascript">
    var host = "http://cole-maclean.github.io/";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
    </script>
     <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-71787228-1', 'auto');
ga('send', 'pageview');

</script>
 
</head>

	<body class="home blog et_pb_button_helper_class home-posts et_fixed_nav et_show_nav et_cover_background et_pb_gutter windows et_pb_gutters3 et_primary_nav_dropdown_animation_fade et_secondary_nav_dropdown_animation_fade et_pb_footer_columns4 et_header_style_left et_right_sidebar chrome">
		<div id="page-container">
    		<header id="main-header" data-height-onload="66">
	<div class="container clearfix et_menu_container">
		<div class="logo_container">
			<span class="logo_helper"></span>
			<a href="/">
				<!--img src="http://blog.ibireme.com/wp-content/uploads/2015/05/logo1.png" alt="Garan no dou" id="logo" data-height-percentage="54" /-->
				Online Profile - Cole MacLean
			</a>
		</div>
		<div id="et-top-navigation" data-height="66" data-fixed-height="40">
			<nav id="top-menu-nav">
				<ul id="top-menu" class="nav">
					<li>
						<a class="page-link" href="/">
							Home
						</a>
					</li>
					
					
					<li>
						<a class="page-link" href="/projects/">
							Projects
						</a>
					</li>
					
					
					
					<li>
						<a class="page-link" href="/About/">
							About
						</a>
					</li>
					
					
					
					
					
					
					
					<li>
						<a class="page-link" href="/Archives/">
							Archive
						</a>
					</li>
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					<!-- Social icons from Font Awesome, if enabled -->
					<li>
						<a class="page-link" href="">Find Me</a>
						<ul class="children">












<li>
	<a href="https://github.com/cole-maclean" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>









<li>
	<a href="https://www.linkedin.com/in/macleancole" title="Follow on LinkedIn">
		<i class="fa fa-fw fa-linkedin"></i>
	</a>
</li>















<li>
	<a href="https://twitter.com/ponderingHplus" title="Follow on Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>







<li>
	<a href="https://www.kaggle.com/colemaclean" title="">
		<i>kaggle</i>
	</a>
</li>



<li>
	<a href="mailto:maclean.cole@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>

</ul>
					</li>
					
				</ul>
			</nav>

			<div id="et_mobile_nav_menu">
				<div class="mobile_nav closed">
					<span class="select_page"></span>
					<span class="mobile_menu_bar"></span>
				</div>
			</div>				
		</div> <!-- #et-top-navigation -->
	</div> <!-- .container -->
	<div class="et_search_outer">
		<div class="container et_search_form_container">
			<form role="search" method="get" class="et-search-form" action="http://cole-maclean.github.io/">
			<input type="search" class="et-search-field" placeholder="搜索 &hellip;" value="" name="s" title="搜索：" /></form>
			<span class="et_close_search_field"></span>
		</div>
	</div>
</header> <!-- #main-header -->

    		<div id="et-main-area">
      			

	
	    
	        
	    
	        
	    
	        
	    
	    
	

	
	    
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	

<article >
  <header style="background-image: url('/')">

<!--article  >
  <div style="background-image: url('/')"/>
  <header style="background-image: url('')"-->
    <h1 class="title">Evolving the StarCraftII Build Order Meta</h1>
    <p id="subtitletrans" class="subtitlecontainer">
    <a class="subtitle">2017-10-22</a> | <a class = "subtittle" href=>HN</a>
	 <a class="subtitle"></a> <a class="subtitle">  <i class="fa fa-tags"></i>: <a href="/tags/python/">python</a>, <a href="/tags/tensorflow/">tensorflow</a>, <a href="/tags/rnn/">rnn</a>, <a href="/tags/eda/">EDA</a>, <a href="/tags/data-munging/">Data Munging</a>, <a href="/tags/deep-learning/">Deep Learning</a>, <a href="/tags/flask/">flask</a>, <a href="/tags/d3js/">d3.js</a></a>
    </p>
  </header>
  <section class="post-content">
  <h2>Introduction</h2>

<p>Google&#39;s Artificial Intelligence research group, <a href="https://deepmind.com/">DeepMind</a> recently released a python API, <a href="https://github.com/deepmind/pysc2">pySC2</a> for the popular Real Time Strategy (RTS) computer game, <a href="http://us.battle.net/sc2/en/">StarCraftII</a>. After successfully conquering the boardgame, Go, with their AlphaGo program, <a href="https://deepmind.com/blog/deepmind-and-blizzard-open-starcraft-ii-ai-research-environment/">DeepMind has set their sights</a> on the next big challenge for AI systems in attempting to train these systems to learn how to compete with world champions in the increadibly complex world of StarCraft. In this post, we use the pySC2 API to collect gameplay data from replays of human played games with the aim of discoverying some macro elements of the game, such as the different technology progression trees players use. Ultimately, the hope is to build up some intuition on what data is availible from the pySC2 API and how it might be useful in building systems capable of playing the game, but that work will be outside the scope of this post. For now we aim to discover the order of technology and units built by human players, and how those build orders change depending on what players learn about the build order of their opponent.</p>

<h3>StarCraftII</h3>

<p>StarCraftII is a Real Time Strategy game where players compete against each other on a game map by building an army of units to defeat the opponents army of units and associated buildings. Players need to construct buildings from gathered resources that allow them to create new units and buildings that advance the technology of the player to build stronger units. Each player has many options for how they wish to advance their technology tree, made more complex by the existance of 3 races (Terran, Protoss and Zerg) a player can select from with each having unique units, buildings and technology advancements. Different technologies are better at defeating certain units of the opposing players, but each player can only see the technology advancement of their opponent by using units to search across the map to see what the oppenent is doing and to learn how best to adapt their technology advancement against what their opponent is building.</p>

<h3>Dataset</h3>

<p>The dataset was collected using the pySC2 API from replays released by Blizzard Entertainment for version 3.16.1 of the game. The data is only taken from replays of Platinum players (MMR &gt; 3440) and only utilizes the feature layers exposed by the API. The final dataset contains over 25,000 replays, with half being from player1&#39;s persepective and the other half from player2&#39;s persepective of the same replay. The state of the game for each replay was taken every 1 second and saved into a state data list with the following elements at each index.</p>

<p>State Data:<br>
0: replay_id<br>
1: map_name<br>
2: player_id<br>
3: minimap - blank list []<br>
4: friendly_army - [unit_id,count]<br>
5: enemy_army  - [unit_id, count]<br>
6: player (resource data)<br>
7: availible_actions<br>
8: taken actions<br>
9: winner<br>
10: race<br>
11: enemy race</p>

<h2>BuildRecommender Class</h2>

<p>To perform the analysis, we have a helper class that abstracts away the data-munging and machine-learning tasks we&#39;ll be utilizing. The class became a bit of a behemoth and could probably use some refactoring, but it has everything we need to load up the data, transform it, train the RNN model and evolve its hyperparameters and finally make the build predictions we&#39;re after. The full class can be found in this analysis&#39; <a href="https://github.com/cole-maclean/autocraft">repository</a>, but we&#39;ll highlight the more interesting bits throughout this notebook.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">BuildRecommender</span> <span class="kn">import</span> <span class="n">BuildRecommender</span>
</code></pre></div>
<h2>Exploratory Data Analysis</h2>

<p>Before jumping right into building a model, lets explore the build order data, building visualizations to view common builds and get a sense of the dataset.</p>

<h3>Build Data</h3>

<p>We can use the data loader to collect the build order data we have. The data has been parsed into a 6-tuple of [build_order,won,race,enemy_race,map,replay_id] where build order is a list of uniquely seen buildings and units in order of sighting by the players perspective. Builds/units are marked with a trailing 0 or 1 to indicate if the unit is the player&#39;s(0) or the opponent&#39;s(1). Won indicates whether the player won the match or not.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#parse, save and load build data</span>
<span class="n">builder</span> <span class="o">=</span> <span class="n">BuildRecommender</span><span class="p">(</span><span class="s">"replay_state_data"</span><span class="p">,</span><span class="s">'build_orders.json'</span><span class="p">)</span>
<span class="c">#builder.save_all_build_orders()</span>
<span class="n">all_builds</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">load_all_build_orders</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">s replays collected"</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_builds</span><span class="p">)))</span>
<span class="c">#example build_data</span>
<span class="n">all_builds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">25115 replays collected





[['Nexus0',
  'Probe0',
  'Pylon0',
  'Gateway0',
  'Assimilator0',
  'Hatchery1',
  'SpawningPool1',
  'Egg1',
  'Drone1',
  'Extractor1',
  'CyberneticsCore0',
  'Overlord1',
  'Stargate0',
  'Adept0',
  'AdeptPhaseShift0',
  'Zergling1',
  'Oracle0',
  'WarpGate0',
  'Queen1',
  'CreepTumor1',
  'Zealot0',
  'Larva1',
  'SporeCrawler1',
  'Sentry0',
  'TwilightCouncil0',
  'Forge0',
  'MothershipCore0',
  'Phoenix0',
  'RoboticsFacility0',
  'OracleStasisTrap0',
  'Overseer1',
  'TemplarArchive0',
  'Lair1',
  'PhotonCannon0',
  'Observer0',
  'WarpPrism0',
  'InfestationPit1',
  'HydraliskDen1',
  'ChangelingZealot1',
  'HighTemplar0',
  'Immortal0',
  'Hydralisk1',
  'Archon0',
  'WarpPrismPhasing0',
  'Mutalisk1',
  'Stalker0',
  'Baneling1',
  'EvolutionChamber1',
  'Spire1',
  'BanelingCocoon1',
  'BroodLord1',
  'CreepTumorBurrowed1',
  'Broodling1',
  'Corruptor1',
  'BroodLordCocoon1',
  'CreepTumorQueen1'],
 False,
 'Protoss',
 'Zerg',
 'Mech Depot LE',
 '0000e057beefc9b1e9da959ed921b24b9f0a31c63fedb8d94a1db78b58cf92c5.SC2Replay']
</code></pre></div>
<h3>Races, Maps and Winrates</h3>

<p>Here we can investigate some general game stats</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="c">#load up static state data into dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">build</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">build</span> <span class="ow">in</span> <span class="n">all_builds</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'Won'</span><span class="p">,</span><span class="s">"Race"</span><span class="p">,</span><span class="s">"EnemyRace"</span><span class="p">,</span><span class="s">"Map"</span><span class="p">,</span><span class="s">"ReplayID"</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">'Race'</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Won</th>
      <th>Race</th>
      <th>EnemyRace</th>
      <th>Map</th>
      <th>ReplayID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>False</td>
      <td>Protoss</td>
      <td>Zerg</td>
      <td>Mech Depot LE</td>
      <td>0000e057beefc9b1e9da959ed921b24b9f0a31c63fedb8...</td>
    </tr>
    <tr>
      <th>17476</th>
      <td>False</td>
      <td>Protoss</td>
      <td>Zerg</td>
      <td>Acolyte LE</td>
      <td>50fcf294b394bf3ef38b326c96b93baf02c8380674c063...</td>
    </tr>
    <tr>
      <th>17489</th>
      <td>True</td>
      <td>Protoss</td>
      <td>Terran</td>
      <td>Catallena LE (Void)</td>
      <td>510f3e2b4eaa42cf19401f58758e6d31987320613c18d8...</td>
    </tr>
    <tr>
      <th>17493</th>
      <td>True</td>
      <td>Protoss</td>
      <td>Terran</td>
      <td>Interloper LE</td>
      <td>510f82cc95ed9687a51560a02784e115d8770b2baf18a3...</td>
    </tr>
    <tr>
      <th>6525</th>
      <td>True</td>
      <td>Protoss</td>
      <td>Protoss</td>
      <td>Odyssey LE</td>
      <td>1f4e6a24bfeba8a59e7e77edc75ec85711e20cdc669dbe...</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">races</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'Race'</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">hue_order</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Protoss'</span><span class="p">,</span><span class="s">'Terran'</span><span class="p">,</span><span class="s">'Zerg'</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'Race'</span><span class="p">])</span>
</code></pre></div>
<p><img src="/img/sc2_output.png" alt="png"></p>

<p>Looks like Terran is the most popular race, followed closely by Zerg, but Protoss trailing quite heavily.  </p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s">'Race'</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s">'Won'</span><span class="p">)</span>
</code></pre></div>
<p><img src="/img/output_9_0.png" alt="png"></p>

<p>All races are remarkably balanced in the dataset, with all having nearly exactly 50% winrates and all within the 95% confidence interval of the others.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">map_counts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s">'Map'</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">labels</span><span class="p">,</span><span class="n">values</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">map_counts</span><span class="p">[</span><span class="s">'Won'</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">)</span>
</code></pre></div>
<p><img src="/img/output_11_0.png" alt="png"></p>

<p>That&#39;s a nice looking linearly decreasing trend in map popularity, with Odyssey being the favorite and Catallena way in last, but this is likely due to Catallena being the only 3 player ladder map, which can cause some extra quirks for players playing 1v1 on it.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">map_race_counts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">'Map'</span><span class="p">,</span><span class="s">'Race'</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">mr_df</span> <span class="o">=</span> <span class="n">map_race_counts</span><span class="p">[</span><span class="s">'Won'</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">maps</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">mr_df</span><span class="p">[</span><span class="s">'Map'</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mr_df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s">'Map'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'Won'</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s">'Race'</span><span class="p">,</span><span class="n">hue_order</span><span class="o">=</span><span class="n">hue_order</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s">'Map'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s">'Count'</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</code></pre></div>
<p><img src="/img/output_14_0.png" alt="png"></p>

<p>Protoss seem to especially dislike Catallena, prefering Odyssey and Ascension to Aiur. Terran and Zerg follow closely the general map popularity trend, with Terran favouring Odyssey the most. Terrans seem to be the race most willing to play Catallena. Lets check out the winrates for the races on each map.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">map_race_win_counts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">'Map'</span><span class="p">,</span><span class="s">'Race'</span><span class="p">,</span><span class="s">'Won'</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">mrw_df</span> <span class="o">=</span> <span class="n">map_race_win_counts</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">mrw_df</span><span class="p">[</span><span class="s">'Race_Won'</span><span class="p">]</span> <span class="o">=</span> <span class="n">mrw_df</span><span class="p">[</span><span class="s">'Race'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="n">mrw_df</span><span class="p">[</span><span class="s">'Won'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">mrw_df</span>
</code></pre></div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Map</th>
      <th>Race</th>
      <th>Won</th>
      <th>EnemyRace</th>
      <th>ReplayID</th>
      <th>Race_Won</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Abyssal Reef LE</td>
      <td>Protoss</td>
      <td>False</td>
      <td>439</td>
      <td>439</td>
      <td>ProtossFalse</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Abyssal Reef LE</td>
      <td>Protoss</td>
      <td>True</td>
      <td>437</td>
      <td>437</td>
      <td>ProtossTrue</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Abyssal Reef LE</td>
      <td>Terran</td>
      <td>False</td>
      <td>709</td>
      <td>709</td>
      <td>TerranFalse</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Abyssal Reef LE</td>
      <td>Terran</td>
      <td>True</td>
      <td>727</td>
      <td>727</td>
      <td>TerranTrue</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Abyssal Reef LE</td>
      <td>Zerg</td>
      <td>False</td>
      <td>614</td>
      <td>614</td>
      <td>ZergFalse</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Abyssal Reef LE</td>
      <td>Zerg</td>
      <td>True</td>
      <td>595</td>
      <td>595</td>
      <td>ZergTrue</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Acolyte LE</td>
      <td>Protoss</td>
      <td>False</td>
      <td>418</td>
      <td>418</td>
      <td>ProtossFalse</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Acolyte LE</td>
      <td>Protoss</td>
      <td>True</td>
      <td>416</td>
      <td>416</td>
      <td>ProtossTrue</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Acolyte LE</td>
      <td>Terran</td>
      <td>False</td>
      <td>667</td>
      <td>667</td>
      <td>TerranFalse</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Acolyte LE</td>
      <td>Terran</td>
      <td>True</td>
      <td>625</td>
      <td>625</td>
      <td>TerranTrue</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Acolyte LE</td>
      <td>Zerg</td>
      <td>False</td>
      <td>518</td>
      <td>518</td>
      <td>ZergFalse</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Acolyte LE</td>
      <td>Zerg</td>
      <td>True</td>
      <td>560</td>
      <td>560</td>
      <td>ZergTrue</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Ascension to Aiur LE</td>
      <td>Protoss</td>
      <td>False</td>
      <td>538</td>
      <td>538</td>
      <td>ProtossFalse</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Ascension to Aiur LE</td>
      <td>Protoss</td>
      <td>True</td>
      <td>535</td>
      <td>535</td>
      <td>ProtossTrue</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Ascension to Aiur LE</td>
      <td>Terran</td>
      <td>False</td>
      <td>818</td>
      <td>818</td>
      <td>TerranFalse</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Ascension to Aiur LE</td>
      <td>Terran</td>
      <td>True</td>
      <td>872</td>
      <td>872</td>
      <td>TerranTrue</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Ascension to Aiur LE</td>
      <td>Zerg</td>
      <td>False</td>
      <td>828</td>
      <td>828</td>
      <td>ZergFalse</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Ascension to Aiur LE</td>
      <td>Zerg</td>
      <td>True</td>
      <td>770</td>
      <td>770</td>
      <td>ZergTrue</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Catallena LE (Void)</td>
      <td>Protoss</td>
      <td>False</td>
      <td>255</td>
      <td>255</td>
      <td>ProtossFalse</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Catallena LE (Void)</td>
      <td>Protoss</td>
      <td>True</td>
      <td>242</td>
      <td>242</td>
      <td>ProtossTrue</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Catallena LE (Void)</td>
      <td>Terran</td>
      <td>False</td>
      <td>504</td>
      <td>504</td>
      <td>TerranFalse</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Catallena LE (Void)</td>
      <td>Terran</td>
      <td>True</td>
      <td>505</td>
      <td>505</td>
      <td>TerranTrue</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Catallena LE (Void)</td>
      <td>Zerg</td>
      <td>False</td>
      <td>407</td>
      <td>407</td>
      <td>ZergFalse</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Catallena LE (Void)</td>
      <td>Zerg</td>
      <td>True</td>
      <td>418</td>
      <td>418</td>
      <td>ZergTrue</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Interloper LE</td>
      <td>Protoss</td>
      <td>False</td>
      <td>432</td>
      <td>432</td>
      <td>ProtossFalse</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Interloper LE</td>
      <td>Protoss</td>
      <td>True</td>
      <td>436</td>
      <td>436</td>
      <td>ProtossTrue</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Interloper LE</td>
      <td>Terran</td>
      <td>False</td>
      <td>717</td>
      <td>717</td>
      <td>TerranFalse</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Interloper LE</td>
      <td>Terran</td>
      <td>True</td>
      <td>717</td>
      <td>717</td>
      <td>TerranTrue</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Interloper LE</td>
      <td>Zerg</td>
      <td>False</td>
      <td>633</td>
      <td>633</td>
      <td>ZergFalse</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Interloper LE</td>
      <td>Zerg</td>
      <td>True</td>
      <td>627</td>
      <td>627</td>
      <td>ZergTrue</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Mech Depot LE</td>
      <td>Protoss</td>
      <td>False</td>
      <td>463</td>
      <td>463</td>
      <td>ProtossFalse</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Mech Depot LE</td>
      <td>Protoss</td>
      <td>True</td>
      <td>402</td>
      <td>402</td>
      <td>ProtossTrue</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Mech Depot LE</td>
      <td>Terran</td>
      <td>False</td>
      <td>648</td>
      <td>648</td>
      <td>TerranFalse</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Mech Depot LE</td>
      <td>Terran</td>
      <td>True</td>
      <td>652</td>
      <td>652</td>
      <td>TerranTrue</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Mech Depot LE</td>
      <td>Zerg</td>
      <td>False</td>
      <td>625</td>
      <td>625</td>
      <td>ZergFalse</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Mech Depot LE</td>
      <td>Zerg</td>
      <td>True</td>
      <td>676</td>
      <td>676</td>
      <td>ZergTrue</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Odyssey LE</td>
      <td>Protoss</td>
      <td>False</td>
      <td>592</td>
      <td>592</td>
      <td>ProtossFalse</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Odyssey LE</td>
      <td>Protoss</td>
      <td>True</td>
      <td>597</td>
      <td>597</td>
      <td>ProtossTrue</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Odyssey LE</td>
      <td>Terran</td>
      <td>False</td>
      <td>858</td>
      <td>858</td>
      <td>TerranFalse</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Odyssey LE</td>
      <td>Terran</td>
      <td>True</td>
      <td>939</td>
      <td>939</td>
      <td>TerranTrue</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Odyssey LE</td>
      <td>Zerg</td>
      <td>False</td>
      <td>886</td>
      <td>886</td>
      <td>ZergFalse</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Odyssey LE</td>
      <td>Zerg</td>
      <td>True</td>
      <td>798</td>
      <td>798</td>
      <td>ZergTrue</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="s">'ProtossTrue'</span><span class="p">,</span><span class="s">'ProtossFalse'</span><span class="p">,</span> <span class="s">'TerranTrue'</span><span class="p">,</span><span class="s">'TerranFalse'</span><span class="p">,</span> <span class="s">'ZergTrue'</span><span class="p">,</span><span class="s">'ZergFalse'</span><span class="p">]</span>
<span class="n">fg</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">factorplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'Race_Won'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'ReplayID'</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s">'Race'</span><span class="p">,</span> 
                        <span class="n">col</span><span class="o">=</span><span class="s">'Map'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mrw_df</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">'bar'</span><span class="p">,</span>
                   <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span><span class="n">hue_order</span><span class="o">=</span><span class="n">hue_order</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">fg</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
</code></pre></div>
<p><img src="/img/output_17_0.png" alt="png"></p>

<p>Most ladder maps are also quite balanced, with most races having equal wins and losses on each. The only imbalances that sitck out are Terran over Zerg on both Ascension to Auir and Odyssey and Zerg&#39;s slight advantage over Protoss on Mech Depot. Protoss is the only race that doesn&#39;t seem to have a subsantial edge on any map.  Here&#39;s a summary of the best and worst map for each race with winrates.</p>

<p><b>Protoss</b><br>
Best Map - Interloper (50.2%)<br>
Worst Map - Mech Depot (46.5%)  </p>

<p><b>Terran</b><br>
Best Map - Odyssey (52.3%)<br>
Worst Map - Acolyte (48.4%)  </p>

<p><b>Zerg</b><br>
Best Map - Mech Depot (52.0%)<br>
Worst Map - Odyssey (47.4%)</p>

<h2>Build Orders and Winrates</h2>

<p>Enough game meta, lets see what we can pull out from the build order data from the various replays</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#grab only the firendly build order, filter out the enemies, keep won flag</span>
<span class="n">all_friendly_builds</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">tuple</span><span class="p">([</span><span class="n">unit</span> <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">build</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'0'</span><span class="p">]),</span><span class="n">build</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">build</span> <span class="ow">in</span> <span class="n">all_builds</span><span class="p">]</span>
<span class="n">all_friendly_builds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">[('Nexus0',
  'Probe0',
  'Pylon0',
  'Gateway0',
  'Assimilator0',
  'CyberneticsCore0',
  'Stargate0',
  'Adept0',
  'AdeptPhaseShift0',
  'Oracle0',
  'WarpGate0',
  'Zealot0',
  'Sentry0',
  'TwilightCouncil0',
  'Forge0',
  'MothershipCore0',
  'Phoenix0',
  'RoboticsFacility0',
  'OracleStasisTrap0',
  'TemplarArchive0',
  'PhotonCannon0',
  'Observer0',
  'WarpPrism0',
  'HighTemplar0',
  'Immortal0',
  'Archon0',
  'WarpPrismPhasing0',
  'Stalker0'),
 False]
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">build_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">bld</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">bld</span> <span class="ow">in</span> <span class="n">all_friendly_builds</span><span class="p">]</span>
<span class="n">max_build_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">build_lengths</span><span class="p">)</span>
<span class="n">avg_build_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">build_lengths</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Max build length = </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span><span class="p">(</span><span class="n">max_build_len</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Average build length = </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="n">avg_build_len</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">build_lengths</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">Max build length = 51
Average build length = 23
</code></pre></div>
<p><img src="/img/output_21_1.png" alt="png"></p>

<p>The length of a players build, ie the number of unique units in their tech tree, is a real nice normal distribution, with most games lasting between 20-30 unique buildings and units, tailing off into shorter and longer games up to a max of 51 unique units. There&#39;s a pretty big spike at the 12 unit mark, lets see if we can find what&#39;s causing that.</p>

<p>The script below can sort out the most common build orders at various stages of a game, and find the builds with the most wins.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="k">def</span> <span class="nf">common_builds</span><span class="p">(</span><span class="n">all_builds</span><span class="p">,</span><span class="n">build_start</span><span class="p">,</span><span class="n">len_build</span><span class="p">,</span><span class="n">winner</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">n_top</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="c">#build win rate sorted if winner !=None, otherwise just sort by raw counts</span>
    <span class="k">if</span> <span class="n">winner</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">winning_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c">#get winning and losing build counts to obtain build win rates</span>
        <span class="n">winning_builds</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="n">build</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">build_start</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">build</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">build_start</span> <span class="o">+</span> <span class="n">len_build</span> <span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                  <span class="k">for</span> <span class="n">build</span> <span class="ow">in</span> <span class="n">all_builds</span>
                  <span class="k">if</span> <span class="n">build</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">])</span>
        <span class="n">losing_builds</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="n">build</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">build_start</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">build</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">build_start</span> <span class="o">+</span> <span class="n">len_build</span> <span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                  <span class="k">for</span> <span class="n">build</span> <span class="ow">in</span> <span class="n">all_builds</span>
                  <span class="k">if</span> <span class="n">build</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">False</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">build</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">winning_builds</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">losing_builds</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">build</span> <span class="ow">in</span> <span class="n">winning_builds</span><span class="p">:</span>
                <span class="n">wins</span> <span class="o">=</span> <span class="n">winning_builds</span><span class="p">[</span><span class="n">build</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">wins</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">build</span> <span class="ow">in</span> <span class="n">losing_builds</span><span class="p">:</span>
                <span class="n">loses</span> <span class="o">=</span> <span class="n">losing_builds</span><span class="p">[</span><span class="n">build</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">loses</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">win_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">wins</span><span class="o">/</span><span class="p">(</span><span class="n">wins</span><span class="o">+</span><span class="n">loses</span><span class="p">))</span>
            <span class="n">winning_rates</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">build</span><span class="p">,</span><span class="n">win_rate</span><span class="p">,</span><span class="n">wins</span><span class="p">])</span>
            <span class="c">#sort by build count and then win rate</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">winning_rates</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">reverse</span><span class="o">=</span><span class="n">winner</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">n_top</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#sort by build counts only</span>
        <span class="n">builds</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="n">build</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">build_start</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">build</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">build_start</span> <span class="o">+</span> <span class="n">len_build</span> <span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                  <span class="k">for</span> <span class="n">build</span> <span class="ow">in</span> <span class="n">all_builds</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">builds</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">n_top</span><span class="p">)</span>
</code></pre></div>
<p>Lets take a look at the spike at tech trees of length 12.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">builds</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">build</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">build</span> <span class="ow">in</span> <span class="n">all_friendly_builds</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">build</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">12</span><span class="p">])</span>
<span class="n">cmn_builds</span> <span class="o">=</span> <span class="n">builds</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bld</span> <span class="ow">in</span> <span class="n">cmn_builds</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">bld</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'Extractor0', 'SpawningPool0', 'Zergling0', 'Queen0', 'BanelingNest0', 'BanelingCocoon0', 'Baneling0'), 120)

(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'Extractor0', 'SpawningPool0', 'Zergling0', 'BanelingNest0', 'Queen0', 'BanelingCocoon0', 'Baneling0'), 106)

(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'SpawningPool0', 'Extractor0', 'Zergling0', 'Queen0', 'BanelingNest0', 'BanelingCocoon0', 'Baneling0'), 43)
</code></pre></div>
<p>It looks like there&#39;s a spike at games ending once Zerg players get to Banelings. This might be due to Zergs typically all-ining at this point, or possibly this is when they&#39;re at their weakest state compared to their opponents at this stage (12 unit deep tech trees). Let&#39;s take a look at some other common builds.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">cmn_builds</span> <span class="o">=</span> <span class="n">common_builds</span><span class="p">(</span><span class="n">all_friendly_builds</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">max_build_len</span><span class="p">,</span><span class="n">n_top</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bld</span> <span class="ow">in</span> <span class="n">cmn_builds</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">bld</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'Extractor0', 'SpawningPool0', 'Zergling0', 'Queen0', 'BanelingNest0', 'BanelingCocoon0', 'Baneling0'), 120)

(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'Extractor0', 'SpawningPool0', 'Zergling0', 'Queen0'), 108)

(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'Extractor0', 'SpawningPool0', 'Zergling0', 'BanelingNest0', 'Queen0', 'BanelingCocoon0', 'Baneling0'), 106)

(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'SpawningPool0', 'Extractor0', 'Zergling0', 'Queen0', 'BanelingNest0', 'BanelingCocoon0', 'Baneling0'), 43)

(('Nexus0', 'Probe0', 'Pylon0', 'Forge0', 'PhotonCannon0'), 39)

(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'Extractor0', 'SpawningPool0', 'BanelingNest0', 'Zergling0', 'Queen0', 'BanelingCocoon0', 'Baneling0'), 31)

(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'Extractor0', 'SpawningPool0', 'Zergling0', 'Queen0', 'BanelingNest0'), 29)

(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'SpawningPool0', 'Extractor0', 'Zergling0', 'Queen0'), 28)

(('CommandCenter0', 'SCV0', 'SupplyDepot0', 'Refinery0', 'Barracks0'), 28)

(('Nexus0', 'Probe0', 'Pylon0', 'Gateway0', 'Assimilator0'), 27)
</code></pre></div>
<p>Interesting that Terrans only showup in 1 of the top 10 most common builds. Perhaps they have more variability in how they can start their games. We can checkout the most common early builds (ie first 6 units).</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">cmn_builds</span> <span class="o">=</span> <span class="n">common_builds</span><span class="p">(</span><span class="n">all_friendly_builds</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">n_top</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bld</span> <span class="ow">in</span> <span class="n">cmn_builds</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">bld</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'Extractor0', 'SpawningPool0'), 6316)

(('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'SpawningPool0', 'Extractor0'), 1916)

(('Nexus0', 'Probe0', 'Pylon0', 'Gateway0', 'Assimilator0', 'CyberneticsCore0', 'MothershipCore0'), 1030)

(('Nexus0', 'Probe0', 'Pylon0', 'Gateway0', 'Assimilator0', 'CyberneticsCore0', 'Stargate0'), 998)

(('Nexus0', 'Probe0', 'Pylon0', 'Gateway0', 'Assimilator0', 'CyberneticsCore0', 'Zealot0'), 747)

(('CommandCenter0', 'SCV0', 'SupplyDepot0', 'Refinery0', 'Barracks0', 'Factory0', 'OrbitalCommand0'), 699)

(('Nexus0', 'Probe0', 'Pylon0', 'Gateway0', 'Assimilator0', 'CyberneticsCore0', 'Adept0'), 661)

(('CommandCenter0', 'SCV0', 'SupplyDepot0', 'Refinery0', 'Barracks0', 'SupplyDepotLowered0', 'Factory0'), 654)

(('CommandCenter0', 'SCV0', 'SupplyDepot0', 'Refinery0', 'SupplyDepotLowered0', 'Barracks0', 'Factory0'), 547)

(('CommandCenter0', 'SCV0', 'SupplyDepot0', 'Barracks0', 'Refinery0', 'SupplyDepotLowered0', 'OrbitalCommand0'), 509)
</code></pre></div>
<p>Zergs seem to have the most deterministic beginning game tech tree expansion options being far and away the top two most common opening builds, followed by Protoss, and as suspected, Terrans have more varation to their starts. Lets see how win counts and rates affect the opening 6 unit build counts. </p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">cmn_builds</span> <span class="o">=</span> <span class="n">common_builds</span><span class="p">(</span><span class="n">all_friendly_builds</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">winner</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">n_top</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bld</span> <span class="ow">in</span> <span class="n">cmn_builds</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">bld</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">[('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'Extractor0', 'SpawningPool0'), 0.4968334388853705, 3138]

[('Hatchery0', 'Drone0', 'Overlord0', 'Larva0', 'Egg0', 'SpawningPool0', 'Extractor0'), 0.49739039665970775, 953]

[('Nexus0', 'Probe0', 'Pylon0', 'Gateway0', 'Assimilator0', 'CyberneticsCore0', 'MothershipCore0'), 0.47572815533980584, 490]

[('Nexus0', 'Probe0', 'Pylon0', 'Gateway0', 'Assimilator0', 'CyberneticsCore0', 'Stargate0'), 0.48897795591182364, 488]

[('Nexus0', 'Probe0', 'Pylon0', 'Gateway0', 'Assimilator0', 'CyberneticsCore0', 'Zealot0'), 0.4819277108433735, 360]

[('CommandCenter0', 'SCV0', 'SupplyDepot0', 'Refinery0', 'Barracks0', 'SupplyDepotLowered0', 'Factory0'), 0.5229357798165137, 342]

[('CommandCenter0', 'SCV0', 'SupplyDepot0', 'Refinery0', 'Barracks0', 'Factory0', 'OrbitalCommand0'), 0.48783977110157367, 341]

[('Nexus0', 'Probe0', 'Pylon0', 'Gateway0', 'Assimilator0', 'CyberneticsCore0', 'Adept0'), 0.49319213313161875, 326]

[('CommandCenter0', 'SCV0', 'SupplyDepot0', 'Refinery0', 'SupplyDepotLowered0', 'Barracks0', 'Factory0'), 0.5191956124314442, 284]

[('CommandCenter0', 'SCV0', 'SupplyDepot0', 'Barracks0', 'Refinery0', 'SupplyDepotLowered0', 'OrbitalCommand0'), 0.5363457760314342, 273]
</code></pre></div>
<p>The Zerg openers have the highest number of wins due to the above mentioned limited options they have at the open, but their winrate is pretty similar to the other races typical openers at 50%. Terrans rushing to a Factory or OrbitalCommand seem to have the biggest edge in builds, but only with 52-53% winrates. These numbers will change depending on how you define how many units there are in the &quot;opening&quot; of the game (ie. 6? 7? 10?). The number of different permuations of build orders for each race becomes intractable at even small build counts. For example, assuming 3 availible expansion options at each stage in the tech tree, we could see up to 100 billion different build orders in the average build length of 23 units. Including the opponents potential builds into the order makes the numbers explode even more. There&#39;s no way we can collect enough replays to see every possible build, so we&#39;ll need to build a predictive model based on the data we do have. Below we build a RNN based sequence model in an attempt to learn patterns in our datasets build sequences to generalize to likely other build sequences we might like to investigate. With this model we can also predict the most likely next technology steps our opponent might make at any stage in a game of StarCraftII. </p>

<h2>Build Order Sequence Predictor</h2>

<p>Here we&#39;ll train an RNN model using the <a href="http://tflearn.org/">tflearn</a> API for tensorflow, with some added sauce to get the most out of our model. We&#39;ll use the <a href="https://dask.pydata.org/en/latest/">Dask</a> framework to build some out-of-memory numpy arrays, we&#39;ll incorporate early stopping so we back out of training once our model starts to overfit (validation score begins increasing), and we&#39;re going to use a parallelized Genetic Algorithm to evolve some of the hyperparameters of our model using the <a href="https://github.com/DEAP/deap">DEAP</a> python library. The code implementing these parts are self contained in the BuildRecommender class, but we&#39;ll highlight some snippets and gotchyas here.</p>

<h3>Early Stopping</h3>

<p>Below is the EarlyStoppingCallback class we&#39;ve adapted from the tutorial <a href="http://mckinziebrandon.me/TensorflowNotebooks/2016/11/20/early-stopping.html">here</a>. It allows us to define a condition at the end of each epoch we can check to end training. For our implementation, we stop training if the current epochs validation loss is larger than the best epochs training loss by more than max_val_loss_delta percent.</p>

<p><b>Gotchyas</b><br>
One gotchya that took a bit to figure out was returning the trained model to the program to continue training other models because the early stopping class wasn&#39;t returning anything. I ended up wrapping the tflearn training line in a StopIteration error handle to return the model when early stopping was thrown.  </p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="s">'''Training early stopping error handling snippet'''</span>
<span class="c"># Training</span>
<span class="n">early_stopping_cb</span> <span class="o">=</span> <span class="n">EarlyStoppingCallback</span><span class="p">(</span><span class="n">max_val_loss_delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="c">#Need to catch early stopping to return model</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainY</span><span class="p">,</span> <span class="n">validation_set</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testY</span><span class="p">),</span> <span class="n">show_metric</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">snapshot_epoch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span><span class="n">n_epoch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span><span class="n">run_id</span><span class="o">=</span><span class="s">"</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span><span class="n">n_units</span><span class="p">,</span><span class="n">dropout</span><span class="p">,</span><span class="n">learning_rate</span><span class="p">),</span>
              <span class="n">callbacks</span><span class="o">=</span><span class="n">early_stopping_cb</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
<span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="k">class</span> <span class="nc">EarlyStoppingCallback</span><span class="p">(</span><span class="n">tflearn</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">Callback</span><span class="p">):</span>
    <span class="s">"""
    Early stopping class to exit training when validation loss begins increasing
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_val_loss_delta</span><span class="p">):</span>
        <span class="s">"""
        best_val_loss - stores the best epochs validation loss for current val loss compariason
                        to check if increasing. Initizalized at -inf
        max_val_loss_delta - the maximum percent the current val loss can be above the best_val_loss 
                             without exiting training
        """</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">best_val_loss</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_val_loss_delta</span> <span class="o">=</span> <span class="n">max_val_loss_delta</span>

    <span class="k">def</span> <span class="nf">on_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_state</span><span class="p">):</span>
        <span class="s">""" 
        This is the final method called in trainer.py in the epoch loop. 
        We can stop training and leave without losing any information with a simple exception.
        On epoch end, check if validation loss has increased by more than max_val_loss_delta, if True,
        exit training  
        """</span>
        <span class="c">#check if current loss better than previous best and store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_val_loss</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">training_state</span><span class="o">.</span><span class="n">val_loss</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">best_val_loss</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">training_state</span><span class="o">.</span><span class="n">val_loss</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_val_loss</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_val_loss</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">max_val_loss_delta</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Terminating training at the end of epoch"</span><span class="p">,</span> <span class="n">training_state</span><span class="o">.</span><span class="n">epoch</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Epoch loss = </span><span class="si">%</span><span class="s">s vs best loss = </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span><span class="p">(</span><span class="n">training_state</span><span class="o">.</span><span class="n">val_loss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_val_loss</span><span class="p">))</span>
            <span class="k">raise</span> <span class="nb">StopIteration</span>      

    <span class="k">def</span> <span class="nf">on_train_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_state</span><span class="p">):</span>
        <span class="s">"""
        Furthermore, tflearn will then immediately call this method after we terminate training, 
        (or when training ends regardless). This would be a good time to store any additional 
        information that tflearn doesn't store already.
        """</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Successfully left training! Final model loss:"</span><span class="p">,</span> <span class="n">training_state</span><span class="o">.</span><span class="n">val_loss</span><span class="p">)</span>
</code></pre></div>
<h3>Model Definition</h3>

<p>Below is the model definition and training scripts used to train the network. It takes as input some hyperparameters of the model (which could come from an evolution process...), builds the network definition using tflearns API and initiates the model fitting on the data.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hyperparams</span><span class="p">):</span>
        <span class="c">#reset graph from previously trained iterations</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">reset_default_graph</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_training_data</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trainX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>    

        <span class="c"># Hyperparameters</span>
        <span class="n">arch</span><span class="p">,</span><span class="n">n_units</span><span class="p">,</span><span class="n">dropout</span><span class="p">,</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">hyperparams</span>

        <span class="c"># Network building</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">input_data</span><span class="p">([</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_seq_len</span><span class="p">])</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="n">output_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span><span class="n">trainable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">net</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">lstm</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">n_units</span><span class="o">=</span><span class="n">n_units</span><span class="p">,</span>
                               <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
                               <span class="n">weights_init</span><span class="o">=</span><span class="n">tflearn</span><span class="o">.</span><span class="n">initializations</span><span class="o">.</span><span class="n">xavier</span><span class="p">(),</span><span class="n">return_seq</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">net</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">gru</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">n_units</span><span class="o">=</span><span class="n">n_units</span><span class="p">,</span>
                              <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
                              <span class="n">weights_init</span><span class="o">=</span><span class="n">tflearn</span><span class="o">.</span><span class="n">initializations</span><span class="o">.</span><span class="n">xavier</span><span class="p">(),</span><span class="n">return_seq</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">fully_connected</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="n">activation</span><span class="o">=</span><span class="s">'softmax'</span><span class="p">,</span>
                                      <span class="n">weights_init</span><span class="o">=</span><span class="n">tflearn</span><span class="o">.</span><span class="n">initializations</span><span class="o">.</span><span class="n">xavier</span><span class="p">())</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">regression</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s">'adam'</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span>
                                 <span class="n">loss</span><span class="o">=</span><span class="s">'categorical_crossentropy'</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">DNN</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">tensorboard_verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                            <span class="n">tensorboard_dir</span><span class="o">=</span><span class="s">'C:/Users/macle/Desktop/Open Source Projects/autocraft/EDA/tensorboard'</span><span class="p">)</span>       

        <span class="c"># Training</span>
        <span class="n">early_stopping_cb</span> <span class="o">=</span> <span class="n">EarlyStoppingCallback</span><span class="p">(</span><span class="n">max_val_loss_delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="c">#Need to catch early stopping to return model</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainY</span><span class="p">,</span> <span class="n">validation_set</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testY</span><span class="p">),</span> <span class="n">show_metric</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">snapshot_epoch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                      <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span><span class="n">n_epoch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span><span class="n">run_id</span><span class="o">=</span><span class="s">"</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span><span class="n">n_units</span><span class="p">,</span><span class="n">dropout</span><span class="p">,</span><span class="n">learning_rate</span><span class="p">),</span>
                      <span class="n">callbacks</span><span class="o">=</span><span class="n">early_stopping_cb</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">model</span>
        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model</span>
</code></pre></div>
<h3>Hyperparameter Evolution</h3>

<p>Below is the hyperparameter&#39;s evolve function, which was modified only slightly from the DEAP overview tutorial <a href="https://deap.readthedocs.io/en/master/overview.html">here</a> We&#39;re going to evolve 4 hyperparameters of the model - The RNN cell architecture (LSTM or GRU), the number of units in the recurrent layer, the dropout and the learning rate.</p>

<p><b>Gotchyas</b><br>
In order to run on multiple processors, the DEAP framework requires the evolve creator object and evolve function to be in the global scope of the main script, so these are not methods of the BuildRecommender class, they are seperate and in the global scope of the script.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#DEAP creator definition needs to be in global scope to parallelize</span>
<span class="n">creator</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">"FitnessMax"</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">Fitness</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,))</span>
<span class="c">#Individual represented as list of 4 floats </span>
<span class="c">#(arch,n_units,dropout,learning_rate)</span>
<span class="c">#arch is the cell architecture 0 = lstm, 1 = gru</span>
<span class="c">#floats are later decoded to appropriate sizes</span>
<span class="c">#for each hyperparamter</span>
<span class="n">IND_SIZE</span><span class="o">=</span><span class="mi">4</span>
<span class="n">creator</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">"Individual"</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">fitness</span><span class="o">=</span><span class="n">creator</span><span class="o">.</span><span class="n">FitnessMax</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">evolve</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="n">n_pop</span><span class="p">,</span><span class="n">co_prob</span><span class="p">,</span><span class="n">mut_prob</span><span class="p">,</span><span class="n">n_generations</span><span class="p">):</span>
        <span class="s">'''Evolve the models hyperarameters (arch,n_units,dropout,learning_rate)'''</span>

        <span class="n">toolbox</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">Toolbox</span><span class="p">()</span>
        <span class="c">#Setup fitness (maximize val_loss)</span>
        <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">"attr_float"</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">)</span>
        <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">"individual"</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">initRepeat</span><span class="p">,</span> <span class="n">creator</span><span class="o">.</span><span class="n">Individual</span><span class="p">,</span>
                         <span class="n">toolbox</span><span class="o">.</span><span class="n">attr_float</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">IND_SIZE</span><span class="p">)</span>
        <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">"mate"</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">cxTwoPoint</span><span class="p">)</span>
        <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">"mutate"</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">mutGaussian</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">indpb</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">"select"</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">selTournament</span><span class="p">,</span> <span class="n">tournsize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">"evaluate"</span><span class="p">,</span> <span class="n">builder</span><span class="o">.</span><span class="n">evaluate</span><span class="p">)</span>
        <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">"population"</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">initRepeat</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">toolbox</span><span class="o">.</span><span class="n">individual</span><span class="p">)</span>

        <span class="c">#assign the number of processors to run parallel fitness evaluations on</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">"map"</span><span class="p">,</span> <span class="n">pool</span><span class="o">.</span><span class="nb">map</span><span class="p">)</span>

        <span class="n">pop</span> <span class="o">=</span> <span class="n">toolbox</span><span class="o">.</span><span class="n">population</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n_pop</span><span class="p">)</span>
        <span class="n">best_ind</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">best_fit</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span>

        <span class="c"># Evaluate the entire population</span>
        <span class="n">fitnesses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">toolbox</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">toolbox</span><span class="o">.</span><span class="n">evaluate</span><span class="p">,</span> <span class="n">pop</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">fit</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">fitnesses</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Evaluating </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span><span class="n">ind</span><span class="p">)</span>
            <span class="n">ind</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">fit</span>

        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_generations</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Running generation </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
            <span class="c"># Select the next generation individuals</span>
            <span class="n">offspring</span> <span class="o">=</span> <span class="n">toolbox</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">))</span>
            <span class="c"># Clone the selected individuals</span>
            <span class="n">offspring</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">toolbox</span><span class="o">.</span><span class="n">clone</span><span class="p">,</span> <span class="n">offspring</span><span class="p">))</span>

            <span class="c"># Apply crossover and mutation on the offspring</span>
            <span class="k">for</span> <span class="n">child1</span><span class="p">,</span> <span class="n">child2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">offspring</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">offspring</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">co_prob</span><span class="p">:</span>
                    <span class="n">toolbox</span><span class="o">.</span><span class="n">mate</span><span class="p">(</span><span class="n">child1</span><span class="p">,</span> <span class="n">child2</span><span class="p">)</span>
                    <span class="k">del</span> <span class="n">child1</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span>
                    <span class="k">del</span> <span class="n">child2</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span>

            <span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">offspring</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">mut_prob</span><span class="p">:</span>
                    <span class="n">toolbox</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">mutant</span><span class="p">)</span>
                    <span class="k">del</span> <span class="n">mutant</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span>

            <span class="c"># Evaluate the individuals with an invalid fitness</span>
            <span class="n">invalid_ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">offspring</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ind</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">valid</span><span class="p">]</span>
            <span class="n">fitnesses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">toolbox</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">toolbox</span><span class="o">.</span><span class="n">evaluate</span><span class="p">,</span> <span class="n">pop</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">fit</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">invalid_ind</span><span class="p">,</span> <span class="n">fitnesses</span><span class="p">):</span>
                <span class="n">ind</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">fit</span>
                <span class="c">#keep the single best perfoming ind through all gens</span>
                <span class="k">if</span> <span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">best_fit</span><span class="p">:</span>
                    <span class="n">best_ind</span> <span class="o">=</span> <span class="n">ind</span>
                    <span class="n">best_fit</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c"># The population is entirely replaced by the offspring</span>
            <span class="n">pop</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">offspring</span>
        <span class="k">return</span> <span class="n">best_ind</span>
</code></pre></div>
<p>The above evolution process was used for 5 generations of 16 individuals on an AWS instance with only 5% of the data to identify the best individual hyperparameters, which ended up being: [1,333,0.65,0.0055]. We&#39;ll use these hyperparameters to train a final model on the total dataset. Extending the hyperparameter evolution from 5% of the dataset to the whole thing is a big assumption, and the model would likely perform better if we evolved the hyperparameters on the full data, but for the sake of time we&#39;ll use the smaller evolved hyperparameters as a proxy for the final model&#39;s. It turned out that the learning rate for the evolved network was to large, so we&#39;ve added an extra 0 to it to train on the full dataset.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">builder</span> <span class="o">=</span> <span class="n">BuildRecommender</span><span class="p">(</span><span class="s">"replay_state_data"</span><span class="p">,</span><span class="s">'build_orders.json'</span><span class="p">,</span>
                           <span class="n">down_sample</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">hyperparams</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">333</span><span class="p">,</span><span class="mf">0.65</span><span class="p">,</span><span class="mf">0.00055</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">Training Step: 32009  | total loss: [1m[32m2.67556[0m[0m | time: 6093.463s
| Adam | epoch: 005 | loss: 2.67556 -- iter: 819328/819441
Training Step: 32010  | total loss: [1m[32m2.64712[0m[0m | time: 6358.537s
| Adam | epoch: 005 | loss: 2.64712 | val_loss: 2.51044 -- iter: 819441/819441
--
Successfully left training! Final model loss: 2.51044451435
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">model_score</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">testX</span><span class="p">,</span> <span class="n">builder</span><span class="o">.</span><span class="n">testY</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">model_score</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">c:\python35\lib\site-packages\dask\core.py:306: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  elif type_arg is type(key) and arg == key:





0.35719829542609255
</code></pre></div>
<p>The model only trains for 5 epochs on the full dataset, so there might be potential to squeek out even better performance with smaller learning rates, but the performance of this model is actually already impressive, getting 36% of the predicted next unit exactly correct. Using some further heuristics like only predicting units that exist in the race of the player we&#39;re predicting for should increase this number even further.</p>

<h2>Using the Model</h2>

<p>Now that we have a trained model capable of predicting the sequence of builds in StarCraftII, we can use it to make predictions of how games will develop starting from arbitrary initial builds. Lets first check the most common build we discovered above - zerg rush to Banelings. We&#39;ll input the sequence of builds leading up to banelings and hopefully our model will predict correctly.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">builder</span><span class="o">.</span><span class="n">load_graph</span><span class="p">()</span>
<span class="n">rec_build</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">predict_build</span><span class="p">([</span><span class="s">'Hatchery0'</span><span class="p">,</span> <span class="s">'Drone0'</span><span class="p">,</span> <span class="s">'Overlord0'</span><span class="p">,</span> <span class="s">'Larva0'</span><span class="p">,</span> <span class="s">'Egg0'</span><span class="p">,</span>
                                   <span class="s">'Extractor0'</span><span class="p">,</span> <span class="s">'SpawningPool0'</span><span class="p">,</span> <span class="s">'Zergling0'</span><span class="p">,</span> <span class="s">'Queen0'</span><span class="p">,</span>
                                   <span class="s">'BanelingNest0'</span><span class="p">,</span> <span class="s">'BanelingCocoon0'</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">races</span><span class="o">=</span><span class="p">[</span><span class="s">'Zerg0'</span><span class="p">,</span><span class="s">'Terran1'</span><span class="p">])</span>
<span class="n">rec_build</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">['Baneling0']
</code></pre></div>
<p>Nailed it! Looks like, at the very least, our model has discovered the most common build. Lets see how each race starts look.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">builder</span><span class="o">.</span><span class="n">predict_build</span><span class="p">([</span><span class="s">'CommandCenter0'</span><span class="p">],</span><span class="mi">6</span><span class="p">,</span><span class="n">races</span><span class="o">=</span><span class="p">[</span><span class="s">'Terran0'</span><span class="p">,</span><span class="s">'Zerg1'</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">['SCV0',
 'SupplyDepot0',
 'Refinery0',
 'Barracks0',
 'SupplyDepotLowered0',
 'Factory0']
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">builder</span><span class="o">.</span><span class="n">predict_build</span><span class="p">([</span><span class="s">'Hatchery0'</span><span class="p">],</span><span class="mi">6</span><span class="p">,</span><span class="n">races</span><span class="o">=</span><span class="p">[</span><span class="s">'Zerg0'</span><span class="p">,</span><span class="s">'Protoss1'</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">['Drone0', 'Overlord0', 'Larva0', 'Egg0', 'Extractor0', 'SpawningPool0']
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">builder</span><span class="o">.</span><span class="n">predict_build</span><span class="p">([</span><span class="s">'Nexus0'</span><span class="p">],</span><span class="mi">6</span><span class="p">,</span><span class="n">races</span><span class="o">=</span><span class="p">[</span><span class="s">'Protoss0'</span><span class="p">,</span><span class="s">'Zerg1'</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">['Probe0', 'Pylon0', 'Gateway0', 'Assimilator0', 'CyberneticsCore0', 'Zealot0']
</code></pre></div>
<p>Those builds seem pretty sensible to me, looks like our model has correctly captured how each race normally expands their tech tree. The text interface we&#39;re using here isn&#39;t very user friendly, so we&#39;ll build a super simple visualization and webapp so people can play with the model and make their own builds.</p>

<h2>Webapp</h2>

<p>Using the final model built above, I threw together a simple webapp so users can discover and visualize their own custom StarCraftII build orders. The webapp can be played with <a href="http://ponderinghydrogen.pythonanywhere.com/sc2">here</a>. Note that the app makes an single inference from the model for each unit added to the build order, so large build orders can take a looong time to process.</p>

<p><img src="/img/sc2_webapp.PNG" alt="webapp"></p>

<h2>Conclusions</h2>

<p>There were three main goals of this project:
1. Build familiarity with the pySC2 API and data<br>
2. Develop a StarCraftII build order predictive model<br>
3. Learn and test the applications of Genetic Algorithms to neural network hyperparameter optimization   </p>

<p>Another final goal was to have fun with it! I think I accomplished all of those goals, and am pretty impressed by the deep learning scaffolding I&#39;ve built-up: from data-munging and representation to model definitions and now hyperparameter evolutions. I think next steps will be to bring these skills into a Reinforcement Learning (RL) project and see if I can start training a StarCraftII bot to play the game!</p>

<h2>Limitations and Future Work</h2>

<p><b>Unique Unit Builds and Upgrades</b><br>
The build orders in this project are only unique units/tech tree expansions seen as the game progresses, where in reality the number of buildings/units you create is very important (ie. 2/3 Barracks&#39; built in the early game). Another missing component in the tech stack is researched capabilities and upgrades a player can build to boost their units strength. To get a more accurate representation of the StarCraftII&#39;s build order meta, these components will need to be included.</p>

<p><b>Hyperparameter Evolving</b><br>
There are many other hyperparameters in the model that could be evolved like activation functions (aside: There&#39;s an interesting conversation happening on <a href="https://www.reddit.com/r/MachineLearning/comments/773epu/r_swish_a_selfgated_activation_function_google/">r/MachineLearning</a> about these right now), the number of layers, embedding dimensions etc. Our evolutionary method actually has more hyperparameters to tune then the ones we&#39;re actually tuning! (ie. crossover, muatation rates and all the other turtles). We also only allowed the evolution process to continue for 5 generations, which may not be enough to discover really good hyperparameter combinations, but I still prefer this over grid/random search methods. To really get the most out of this approach, we should probably tune our hyperparameters using the full dataset and let the process run for a longer period, plus adding in more of the hyperparameters of the model.</p>

<p><b>Optimal Build Order</b><br>
Although our model is capable of capturing the likely build orders of Platinum and above players, it doesn&#39;t actually incorporate winrates or a concept of optimality in the builds. This project could be extended to an RL setting where a model could be trained capable of learning an optimal policy and a learned value function that estimates the probability of winning given the current state of the game. This problem would likely be a good use case for Actor-Critic methods that learn policy and value functions together, such as the one Google is seeing substantial successes in with <a href="https://deepmind.com/blog/alphago-zero-learning-scratch/">AlphaGo.</a></p>

<p><b>The Changing Meta</b><br>
Updates to StarCraftII are continually being made to add new content and balance units. This causes the advantages of units and build orders to change over time as the game evolves. The method developed in this post could be extended to predict the impact game changes might have on build metas and potentially identify new, successful builds before opponents do to give players an extra edge in the game.</p>

  </section>
  
</article>

<!-- Post navigation -->


<!-- Disqus -->


    		</div> <!-- #et-main-area -->
		</div> <!-- #page-container -->
		
<script src="/js/katex_init.js"></script>



<footer id="page-footer-trans" class="page-footer">
	<!--<p class="text"><a href="http://cole-maclean.github.io/">Cole MacLean</a>
</p>-->
	<p class="text">Hosted by <a href="https://github.com">GitHub</a>. Theme created by <a href="https://github.com/fengzhichu/fengzhichu-theme/tree/gh-pages">枫之楚</a></p>
</footer>


    
<!-- WP Audio player plugin v1.9.3 - https://www.tipsandtricks-hq.com/wordpress-audio-music-player-plugin-4556/ -->
    <script type="text/javascript">
        soundManager.useFlashBlock = true; // optional - if used, required flashblock.css
        soundManager.url = '/plugins/soundmanager2.swf';
        function play_mp3(flg, ids, mp3url, volume, loops)
        {
            //Check the file URL parameter value
            var pieces = mp3url.split("|");
            if (pieces.length > 1) {//We have got an .ogg file too
                mp3file = pieces[0];
                oggfile = pieces[1];
                //set the file URL to be an array with the mp3 and ogg file
                mp3url = new Array(mp3file, oggfile);
            }

            soundManager.createSound({
                id: 'btnplay_' + ids,
                volume: volume,
                url: mp3url
            });

            if (flg == 'play') {
                    soundManager.play('btnplay_' + ids, {
                    onfinish: function() {
                        if (loops == 'true') {
                            loopSound('btnplay_' + ids);
                        }
                        else {
                            document.getElementById('btnplay_' + ids).style.display = 'inline';
                            document.getElementById('btnstop_' + ids).style.display = 'none';
                        }
                    }
                });
            }
            else if (flg == 'stop') {
    //soundManager.stop('btnplay_'+ids);
                soundManager.pause('btnplay_' + ids);
            }
        }
        function show_hide(flag, ids)
        {
            if (flag == 'play') {
                document.getElementById('btnplay_' + ids).style.display = 'none';
                document.getElementById('btnstop_' + ids).style.display = 'inline';
            }
            else if (flag == 'stop') {
                document.getElementById('btnplay_' + ids).style.display = 'inline';
                document.getElementById('btnstop_' + ids).style.display = 'none';
            }
        }
        function loopSound(soundID)
        {
            window.setTimeout(function() {
                soundManager.play(soundID, {onfinish: function() {
                        loopSound(soundID);
                    }});
            }, 1);
        }
        function stop_all_tracks()
        {
            soundManager.stopAll();
            var inputs = document.getElementsByTagName("input");
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i].id.indexOf("btnplay_") == 0) {
                    inputs[i].style.display = 'inline';//Toggle the play button
                }
                if (inputs[i].id.indexOf("btnstop_") == 0) {
                    inputs[i].style.display = 'none';//Hide the stop button
                }
            }
        }
    </script>
    <script type='text/javascript' src="/js/frontend-builder-global-functions.js"></script>
<script type='text/javascript' src="/js/custom.js"></script>
<script type='text/javascript' src="/js/jquery.fitvids.js"></script>
<script type='text/javascript' src="/js/waypoints.min.js"></script>
<script type='text/javascript' src="/js/jquery.magnific-popup.js"></script>
<script type='text/javascript'>
/* <![CDATA[ */
var et_custom = {"ajaxurl":"http:\/\/blog.ibireme.com\/wp-admin\/admin-ajax.php","images_uri":"http:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/images","builder_images_uri":"http:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/includes\/builder\/images","et_load_nonce":"ae39988568","subscription_failed":"Please, check the fields below to make sure you entered the correct information.","fill":"Fill","field":"field","invalid":"Invalid email","captcha":"Captcha","prev":"Prev","previous":"\u4e0a\u4e00\u9875","next":"\u4e0b\u4e00\u9875","is_builder_plugin_used":""};
/* ]]> */
</script>
<script type='text/javascript' src="/js/frontend-builder-scripts.js"></script>
  </body>
</html>
