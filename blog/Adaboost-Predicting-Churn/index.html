<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="zh-CN">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US" class="js">
<!--<![endif]-->
  

	
	    
	        
	    
	        
	    
	        
	    
	    
	

	
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	
<head>
	<meta charset="utf-8">
	<title>Sklearn Compatable AdaBoost from Scratch and Predicting Customer Churn | Online Profile</title>
	<meta name="description" content=", python, sklearn, seaborn, matplotlib, EDA, numpy, pandas, Data Munging, Machine Learning,  MAI-IML Exercise 4: Adaboost from Scratch and Predicting Customer Churn">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-Frame-Options" content="sameorigin">
	<!-- CSS -->
	<link rel="stylesheet" href="/css/main.css">
	<link rel='stylesheet' id='divi-style-css'  href="/css/style.css" type='text/css' media='all' />
	<link rel="stylesheet" href="/css/post.style.css">
	<link rel="stylesheet" href="/css/highlight.css">

	<script type='text/javascript' src="/js/jquery.js"></script>
	<script type='text/javascript' src="/js/soundmanager2-nodebug-jsmin.js"></script>

	<!--Favicon-->
	<link rel="icon" href="favicon.ico" type="image/x-icon"/>
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	
	<link href="/favicon.ico" mce_href="favicon.ico" rel="bookmark" type="image/x-icon" /> 
	<link href="/favicon.ico" mce_href="favicon.ico" rel="icon" type="image/x-icon" /> 
	<link href="/favicon.ico" mce_href="favicon.ico" rel="shortcut icon" type="image/x-icon" /> 
	<!-- Canonical -->
	<link rel="canonical" href="http://cole-maclean.github.io//blog/Adaboost-Predicting-Churn/">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Online Profile" href="http://cole-maclean.github.io//feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	

	<!-- KaTeX -->
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.js"></script>
	

	<!-- Google Analytics -->
	
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-71787228-1', 'auto');
	ga('send', 'pageview');
	</script>
	

	<script type="text/javascript">
    var host = "http://cole-maclean.github.io/";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
    </script>
     <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-71787228-1', 'auto');
ga('send', 'pageview');

</script>
 
</head>

	<body class="home blog et_pb_button_helper_class home-posts et_fixed_nav et_show_nav et_cover_background et_pb_gutter windows et_pb_gutters3 et_primary_nav_dropdown_animation_fade et_secondary_nav_dropdown_animation_fade et_pb_footer_columns4 et_header_style_left et_right_sidebar chrome">
		<div id="page-container">
    		<header id="main-header" data-height-onload="66">
	<div class="container clearfix et_menu_container">
		<div class="logo_container">
			<span class="logo_helper"></span>
			<a href="/">
				<!--img src="http://blog.ibireme.com/wp-content/uploads/2015/05/logo1.png" alt="Garan no dou" id="logo" data-height-percentage="54" /-->
				Online Profile - Cole MacLean
			</a>
		</div>
		<div id="et-top-navigation" data-height="66" data-fixed-height="40">
			<nav id="top-menu-nav">
				<ul id="top-menu" class="nav">
					<li>
						<a class="page-link" href="/">
							Home
						</a>
					</li>
					
					
					<li>
						<a class="page-link" href="/projects/">
							Projects
						</a>
					</li>
					
					
					
					<li>
						<a class="page-link" href="/About/">
							About
						</a>
					</li>
					
					
					
					
					
					
					
					<li>
						<a class="page-link" href="/Archives/">
							Archive
						</a>
					</li>
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					<!-- Social icons from Font Awesome, if enabled -->
					<li>
						<a class="page-link" href="">Find Me</a>
						<ul class="children">












<li>
	<a href="https://github.com/cole-maclean" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>









<li>
	<a href="https://www.linkedin.com/in/macleancole" title="Follow on LinkedIn">
		<i class="fa fa-fw fa-linkedin"></i>
	</a>
</li>















<li>
	<a href="https://twitter.com/ponderingHplus" title="Follow on Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>







<li>
	<a href="https://www.kaggle.com/colemaclean" title="">
		<i>kaggle</i>
	</a>
</li>



<li>
	<a href="mailto:maclean.cole@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>

</ul>
					</li>
					
				</ul>
			</nav>

			<div id="et_mobile_nav_menu">
				<div class="mobile_nav closed">
					<span class="select_page"></span>
					<span class="mobile_menu_bar"></span>
				</div>
			</div>				
		</div> <!-- #et-top-navigation -->
	</div> <!-- .container -->
	<div class="et_search_outer">
		<div class="container et_search_form_container">
			<form role="search" method="get" class="et-search-form" action="http://cole-maclean.github.io/">
			<input type="search" class="et-search-field" placeholder="搜索 &hellip;" value="" name="s" title="搜索：" /></form>
			<span class="et_close_search_field"></span>
		</div>
	</div>
</header> <!-- #main-header -->

    		<div id="et-main-area">
      			

	
	    
	        
	    
	        
	    
	        
	    
	    
	

	
	    
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	

<article >
  <header style="background-image: url('/')">

<!--article  >
  <div style="background-image: url('/')"/>
  <header style="background-image: url('')"-->
    <h1 class="title">Sklearn Compatable AdaBoost from Scratch and Predicting Customer Churn</h1>
    <p id="subtitletrans" class="subtitlecontainer">
    <a class="subtitle">2016-12-15</a> | <a class = "subtittle" href=>HN</a>
	 <a class="subtitle"></a> <a class="subtitle">  <i class="fa fa-tags"></i>: <a href="/tags/python/">python</a>, <a href="/tags/sklearn/">sklearn</a>, <a href="/tags/seaborn/">seaborn</a>, <a href="/tags/matplotlib/">matplotlib</a>, <a href="/tags/eda/">EDA</a>, <a href="/tags/numpy/">numpy</a>, <a href="/tags/pandas/">pandas</a>, <a href="/tags/data-munging/">Data Munging</a>, <a href="/tags/machine-learning/">Machine Learning</a></a>
    </p>
  </header>
  <section class="post-content">
  <h1> MAI-IML Exercise 4: Adaboost from Scratch and Predicting Customer Churn</h1>

<h2>Abstract</h2>

<p>In this work, we develop a custom adaboost classifier compatible with the sklearn package and test it on a dataset from a telecommunication company requiring the correct classification of custumers likely to &quot;churn&quot;, or quit their services, for use in developing investment plans to retain these high risk customers.</p>

<h2>Adaboost from Scratch</h2>

<p>Defined below is an sklearn compatable estimator utilizing the adaboost algorithm to perform binary classification. The input parameters for this estimator is the number of weak learners (which are decision tree stubs on a single, randomly selected feature) to train and aggregate to produce the final classifier. An optional weight distribution can also be passed to the classifier, which defaults to uniform if not set. This custom estimator will later be utilized to develop a classifier capable of predicting customer churn from labelled customer data.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#imports  </span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>  
<span class="kn">import</span> <span class="nn">warnings</span>  
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">'ignore'</span><span class="p">)</span>  
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>  
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>  
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>  
<span class="kn">from</span> <span class="nn">pandas.tools.plotting</span> <span class="kn">import</span> <span class="n">scatter_matrix</span>  
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>  
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectKBest</span>  
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>  
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>  
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>  
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>  
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>  
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#Custom Classifier  </span>
<span class="kn">from</span> <span class="nn">sklearn.utils.estimator_checks</span> <span class="kn">import</span> <span class="n">check_estimator</span>  
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">ClassifierMixin</span>  
<span class="kn">from</span> <span class="nn">sklearn.utils.validation</span> <span class="kn">import</span> <span class="n">check_X_y</span><span class="p">,</span> <span class="n">check_array</span><span class="p">,</span> <span class="n">check_is_fitted</span>  
<span class="kn">from</span> <span class="nn">sklearn.utils.multiclass</span> <span class="kn">import</span> <span class="n">unique_labels</span>  
<span class="k">class</span> <span class="nc">IMLAdaBoostClassifier</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">ClassifierMixin</span><span class="p">):</span>  

    <span class="s">""" IML implementation of an Adaboost Classifier.
    An implementation of the Adaboost algorithm for classification using decision stubs as the weak learner with n_estimators
    parameter. Weights are initalized as uniform, 1/N and learning rate alpha is calculated using 1/2ln(1-err/err) at each
    estimator timestep.
    Parameters
    ----------
    n_estimators : integer, optional (default=50)
        The maximum number of estimators at which boosting is terminated.
    weights : list, optional (default=uniform)
      The distribution of weights for each example
    Attributes
    ----------
    weak_learners : 3-tuple of weak_learner stub definition of - [feature stub column index, stub split value, greater then or less
    then equality tag]
    classes_ : array of shape = [n_classes]
        The classes labels.
    alphas : array of floats
        Weights for each estimator in the boosted ensemble.
    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="p">[]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weak_learners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alphas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

        <span class="c"># Check that X and y have correct shape</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">check_X_y</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="c"># Store the classes seen during fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes_</span> <span class="o">=</span> <span class="n">unique_labels</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="c">#initialize wents with uniform distribution</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">):</span>
            <span class="c">#for each n estimator, build and store the weak learner with associated alpha's</span>
            <span class="n">weak_learner</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decision_stump</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">weights</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">weak_learner</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weak_learners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weak_learner</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alphas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp_a</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alphas</span><span class="p">)</span> <span class="k">for</span> <span class="n">tmp_a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphas</span><span class="p">]</span><span class="c">#normalize final alphas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_</span> <span class="o">=</span> <span class="n">y</span>
        <span class="c"># Return the classifier</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>

        <span class="c"># Check is fit had been called</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s">'X_'</span><span class="p">,</span> <span class="s">'y_'</span><span class="p">])</span>

        <span class="c"># Input validation</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c">#for each predicting sample, aggregate the weak_learnings by weighted sum and return the sign of the result as the pred</span>
        <span class="n">df_preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">tmp_pred</span><span class="p">)</span> <span class="k">for</span> <span class="n">tmp_pred</span> <span class="ow">in</span> <span class="n">df_preds</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">preds</span>

    <span class="k">def</span> <span class="nf">decision_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">smpl</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
            <span class="n">tmp_pred</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">estimator</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weak_learners</span><span class="p">):</span>
                <span class="c">#get feature and split value from 3-tuple weak_learner [split_feature_indx,split_value, 'gt' or 'lt' tag]</span>
                <span class="n">split_feature</span> <span class="o">=</span> <span class="n">estimator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">split_value</span> <span class="o">=</span> <span class="n">estimator</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#check the weak_learner inequality rule for the smpl and increment aggregation function</span>
                <span class="k">if</span> <span class="n">estimator</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">'gt'</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">smpl</span><span class="p">[</span><span class="n">split_feature</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">split_value</span><span class="p">:</span>
                        <span class="n">tmp_pred</span> <span class="o">=</span> <span class="n">tmp_pred</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tmp_pred</span> <span class="o">=</span> <span class="n">tmp_pred</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span>
                <span class="k">elif</span> <span class="n">estimator</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">'lt'</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">smpl</span><span class="p">[</span><span class="n">split_feature</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">split_value</span><span class="p">:</span>
                        <span class="n">tmp_pred</span> <span class="o">=</span> <span class="n">tmp_pred</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tmp_pred</span> <span class="o">=</span> <span class="n">tmp_pred</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span>
            <span class="n">preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_pred</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decision_stump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">weights</span><span class="p">):</span>
        <span class="c">#create a weak_learning by creating a decision stump by selecting a random feature to split on, using the values</span>
        <span class="c">#in the feature as split values to test until a weak learner (&lt; 50% error) is found for either the greater then or </span>
        <span class="c">#less then split value inequality test. return the created weak learning, updated weights and associated alpha</span>
        <span class="n">rnd_column_indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">rnd_column</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="n">rnd_column_indx</span><span class="p">]</span>
        <span class="n">weak_learner</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">unique_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">rnd_column</span><span class="p">))</span> <span class="c">#create a shuffled list of unique values in selected column to test split values from</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">split_val</span> <span class="ow">in</span> <span class="n">unique_vals</span><span class="p">:</span>
            <span class="c">#check the error rates for stub with split value for &lt; or &gt; rule, if err &lt;50% return resulting weak_learner, alpha</span>
            <span class="c">#and new weights</span>
            <span class="n">gt_prd_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">check_val</span> <span class="o">&gt;=</span> <span class="n">split_val</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">check_val</span> <span class="ow">in</span> <span class="n">rnd_column</span><span class="p">]</span>
            <span class="c">#add small error amount to prevent div by 0 error</span>
            <span class="n">gt_err</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">0</span> <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">gt_prd_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))])</span> <span class="o">+</span> <span class="mf">0.0000001</span>
            <span class="n">lt_prd_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">check_val</span> <span class="o">&lt;=</span> <span class="n">split_val</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">check_val</span> <span class="ow">in</span> <span class="n">rnd_column</span><span class="p">]</span>
            <span class="n">lt_err</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">0</span> <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">lt_prd_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))])</span> <span class="o">+</span> <span class="mf">0.0000001</span>
            <span class="k">if</span> <span class="n">gt_err</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span> 
                <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">gt_err</span><span class="p">)</span><span class="o">/</span><span class="n">gt_err</span><span class="p">)</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">gt_prd_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>
                <span class="n">weak_learner</span> <span class="o">=</span> <span class="p">[</span><span class="n">rnd_column_indx</span><span class="p">,</span><span class="n">split_val</span><span class="p">,</span><span class="s">'gt'</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">weak_learner</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">weights</span>
            <span class="k">elif</span> <span class="n">lt_err</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">lt_err</span><span class="p">)</span><span class="o">/</span><span class="n">lt_err</span><span class="p">)</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">lt_prd_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>
                <span class="n">weak_learner</span> <span class="o">=</span> <span class="p">[</span><span class="n">rnd_column_indx</span><span class="p">,</span><span class="n">split_val</span><span class="p">,</span><span class="s">'lt'</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">weak_learner</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">weights</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">"No Weak Learner Found for feature "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rnd_column_indx</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">weak_learner</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">weights</span>   
</code></pre></div>
<h2>Estimator Testing</h2>

<p>To ensure the estimator has been properly coded, we compare the results on a couple datasets with the packaged adabooster in sklearn. Visualizing the results, we can see the estimator is performing as expected, with similiar results as the sklearn adabooster. The differences likely stem from our custom estimator not encorporating any intelligence in the decision stubs, simply naively selecting any that perform better than random as the weak learning, where sklearns adaboost utilizes decisiontree classifiers as their stubs which optimize the stub splitting based on information gain metrics.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Code source: Gaël Varoquaux</span>
<span class="c">#              Andreas Müller</span>
<span class="c"># Modified for documentation by Jaques Grobler</span>
<span class="c"># License: BSD 3 clause</span>

<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_moons</span><span class="p">,</span> <span class="n">make_circles</span><span class="p">,</span> <span class="n">make_classification</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">AdaBoostClassifier</span>

<span class="n">h</span> <span class="o">=</span> <span class="o">.</span><span class="mo">02</span>  <span class="c"># step size in the mesh</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">"AdaBoost"</span><span class="p">,</span><span class="s">"IMLAdaBoost"</span><span class="p">]</span>

<span class="n">classifiers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">AdaBoostClassifier</span><span class="p">(),</span>
    <span class="n">IMLAdaBoostClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

<span class="p">]</span>


<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span><span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_redundant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_informative</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_clusters_per_class</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">tmp_y</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">tmp_y</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">X</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_moons</span><span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">make_circles</span><span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">]</span>

<span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c"># iterate over datasets</span>
<span class="k">for</span> <span class="n">ds_cnt</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
    <span class="c"># preprocess dataset, split into training and test part</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ds</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">tmp_y</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">tmp_y</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> \
        <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nb">min</span><span class="p">()</span> <span class="o">-</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nb">min</span><span class="p">()</span> <span class="o">-</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span>
    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

    <span class="c"># just plot the dataset first</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu</span>
    <span class="n">cm_bright</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">([</span><span class="s">'#FF0000'</span><span class="p">,</span> <span class="s">'#0000FF'</span><span class="p">])</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">classifiers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ds_cnt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">"Input data"</span><span class="p">)</span>
    <span class="c"># Plot the training points</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm_bright</span><span class="p">)</span>
    <span class="c"># and testing points</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm_bright</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="nb">min</span><span class="p">(),</span> <span class="n">xx</span><span class="o">.</span><span class="nb">max</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="nb">min</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="nb">max</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(())</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c"># iterate over classifiers</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">clf</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">classifiers</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">classifiers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span>

        <span class="c"># Plot the decision boundary. For that, we will assign a color to each</span>
        <span class="c"># point in the mesh [x_min, x_max]x[y_min, y_max].</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="s">"decision_function"</span><span class="p">):</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c"># Put the result into a color plot</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">8</span><span class="p">)</span>

        <span class="c"># Plot also the training points</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm_bright</span><span class="p">)</span>
        <span class="c"># and testing points</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm_bright</span><span class="p">,</span>
                   <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="nb">min</span><span class="p">(),</span> <span class="n">xx</span><span class="o">.</span><span class="nb">max</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="nb">min</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="nb">max</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(())</span>
        <span class="k">if</span> <span class="n">ds_cnt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span> <span class="o">-</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="n">yy</span><span class="o">.</span><span class="nb">min</span><span class="p">()</span> <span class="o">+</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="s">'</span><span class="si">%.2</span><span class="s">f'</span> <span class="o">%</span> <span class="n">score</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">'0'</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">'right'</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img src="/img/sk_compare.png" alt=""></p>

<h2>Customer Churn Exploratory Data Analysis</h2>

<p>Below is a preliminary Exploratory Data Analysis of the customer churn data to help discover any data inconsistencies and provide an intuition for developing a model of customer churn.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"churn.csv"</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>Account Length</th>
      <th>Area Code</th>
      <th>Phone</th>
      <th>Int'l Plan</th>
      <th>VMail Plan</th>
      <th>VMail Message</th>
      <th>Day Mins</th>
      <th>Day Calls</th>
      <th>Day Charge</th>
      <th>...</th>
      <th>Eve Calls</th>
      <th>Eve Charge</th>
      <th>Night Mins</th>
      <th>Night Calls</th>
      <th>Night Charge</th>
      <th>Intl Mins</th>
      <th>Intl Calls</th>
      <th>Intl Charge</th>
      <th>CustServ Calls</th>
      <th>Churn?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>KS</td>
      <td>128</td>
      <td>415</td>
      <td>382-4657</td>
      <td>no</td>
      <td>yes</td>
      <td>25</td>
      <td>265.1</td>
      <td>110</td>
      <td>45.07</td>
      <td>...</td>
      <td>99</td>
      <td>16.78</td>
      <td>244.7</td>
      <td>91</td>
      <td>11.01</td>
      <td>10.0</td>
      <td>3</td>
      <td>2.70</td>
      <td>1</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>OH</td>
      <td>107</td>
      <td>415</td>
      <td>371-7191</td>
      <td>no</td>
      <td>yes</td>
      <td>26</td>
      <td>161.6</td>
      <td>123</td>
      <td>27.47</td>
      <td>...</td>
      <td>103</td>
      <td>16.62</td>
      <td>254.4</td>
      <td>103</td>
      <td>11.45</td>
      <td>13.7</td>
      <td>3</td>
      <td>3.70</td>
      <td>1</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NJ</td>
      <td>137</td>
      <td>415</td>
      <td>358-1921</td>
      <td>no</td>
      <td>no</td>
      <td>0</td>
      <td>243.4</td>
      <td>114</td>
      <td>41.38</td>
      <td>...</td>
      <td>110</td>
      <td>10.30</td>
      <td>162.6</td>
      <td>104</td>
      <td>7.32</td>
      <td>12.2</td>
      <td>5</td>
      <td>3.29</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>OH</td>
      <td>84</td>
      <td>408</td>
      <td>375-9999</td>
      <td>yes</td>
      <td>no</td>
      <td>0</td>
      <td>299.4</td>
      <td>71</td>
      <td>50.90</td>
      <td>...</td>
      <td>88</td>
      <td>5.26</td>
      <td>196.9</td>
      <td>89</td>
      <td>8.86</td>
      <td>6.6</td>
      <td>7</td>
      <td>1.78</td>
      <td>2</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>OK</td>
      <td>75</td>
      <td>415</td>
      <td>330-6626</td>
      <td>yes</td>
      <td>no</td>
      <td>0</td>
      <td>166.7</td>
      <td>113</td>
      <td>28.34</td>
      <td>...</td>
      <td>122</td>
      <td>12.61</td>
      <td>186.9</td>
      <td>121</td>
      <td>8.41</td>
      <td>10.1</td>
      <td>3</td>
      <td>2.73</td>
      <td>3</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">[</span><span class="s">'Churn?'</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">False    2850
True      483
Name: Churn?, dtype: int64
</code></pre></div>
<p>The dataset has 21 features containing information about customer geographic location, the type of service they&#39;ve subscribed to, their usage and interactions with customer service. This information is labelled with whether that user ended up quitting their subscription. The dataset is unbalanced, with 2850 retained customers compared to 483 churned. There are a couple features that are unlikely to provide usable information, like phone number and area code, so they are removed from the dataset.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">filtered_features</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Phone'</span><span class="p">,</span><span class="s">'Area Code'</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">filtered_features</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">hists</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</code></pre></div>
<p><img src="/img/hists.png" alt="png"></p>

<p>Exploring the distributions of the features, almost all of them following closely to normal distributions. The only exception being VMail message, with the majority of users having 0 VMail messages, likely because they have not subscribed to this service.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'State'</span><span class="p">,</span><span class="s">'Churn?'</span><span class="p">])[</span><span class="s">'Account Length'</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
<span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'bar'</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">&lt;matplotlib.axes._subplots.AxesSubplot at 0x2085e7b8940&gt;
</code></pre></div>
<p><img src="/img/states.png" alt="png"></p>

<p>Exploring the churn-rate per state in the above visualization, we can see that there is a wide spread between churn-rate amoung different states, with NJ and TX having high churn and IA and AK with barely any. This islikely due to the different competetion markets across states, and should provide powerful discriminating features in a churn classifier.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s">"Churn?"</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">&lt;seaborn.axisgrid.PairGrid at 0x208460a64a8&gt;
</code></pre></div>
<p><img src="/img/scatter_matrix.png" alt="png"></p>

<p>Reviewing the scatter matrix for each feature reveals the direct linear relationship between call minutes and their respective charges. These redundant features are removed from the dataset to prevent the potential negative influence of dependent features on the classifier. Although some features show a little seperating between churn labels, an obvious feature combination does not appear for discriminating churn customers. A higher dimensional classifier with further combinations of the features will required to build an adequate classifier.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">filtered_features</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Day Mins'</span><span class="p">,</span> <span class="s">'Eve Mins'</span><span class="p">,</span> <span class="s">'Night Mins'</span><span class="p">,</span> <span class="s">'Intl Mins'</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">filtered_features</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>Account Length</th>
      <th>Int'l Plan</th>
      <th>VMail Plan</th>
      <th>VMail Message</th>
      <th>Day Calls</th>
      <th>Day Charge</th>
      <th>Eve Calls</th>
      <th>Eve Charge</th>
      <th>Night Calls</th>
      <th>Night Charge</th>
      <th>Intl Calls</th>
      <th>Intl Charge</th>
      <th>CustServ Calls</th>
      <th>Churn?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>KS</td>
      <td>128</td>
      <td>no</td>
      <td>yes</td>
      <td>25</td>
      <td>110</td>
      <td>45.07</td>
      <td>99</td>
      <td>16.78</td>
      <td>91</td>
      <td>11.01</td>
      <td>3</td>
      <td>2.70</td>
      <td>1</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>OH</td>
      <td>107</td>
      <td>no</td>
      <td>yes</td>
      <td>26</td>
      <td>123</td>
      <td>27.47</td>
      <td>103</td>
      <td>16.62</td>
      <td>103</td>
      <td>11.45</td>
      <td>3</td>
      <td>3.70</td>
      <td>1</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NJ</td>
      <td>137</td>
      <td>no</td>
      <td>no</td>
      <td>0</td>
      <td>114</td>
      <td>41.38</td>
      <td>110</td>
      <td>10.30</td>
      <td>104</td>
      <td>7.32</td>
      <td>5</td>
      <td>3.29</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>OH</td>
      <td>84</td>
      <td>yes</td>
      <td>no</td>
      <td>0</td>
      <td>71</td>
      <td>50.90</td>
      <td>88</td>
      <td>5.26</td>
      <td>89</td>
      <td>8.86</td>
      <td>7</td>
      <td>1.78</td>
      <td>2</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>OK</td>
      <td>75</td>
      <td>yes</td>
      <td>no</td>
      <td>0</td>
      <td>113</td>
      <td>28.34</td>
      <td>122</td>
      <td>12.61</td>
      <td>121</td>
      <td>8.41</td>
      <td>3</td>
      <td>2.73</td>
      <td>3</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s">'yes'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'no'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s">"Int'l Plan"</span><span class="p">:</span> <span class="n">mapping</span><span class="p">,</span> <span class="s">'VMail Plan'</span><span class="p">:</span> <span class="n">mapping</span><span class="p">})</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#One Hot Encode States for classifer</span>
<span class="n">state_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'State'</span><span class="p">]</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">()</span> 
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'State'</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">state_df</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Account Length'</span><span class="p">,</span> <span class="s">"Int'l Plan"</span><span class="p">,</span> <span class="s">'VMail Plan'</span><span class="p">,</span> <span class="s">'VMail Message'</span><span class="p">,</span>
       <span class="s">'Day Calls'</span><span class="p">,</span> <span class="s">'Day Charge'</span><span class="p">,</span> <span class="s">'Eve Calls'</span><span class="p">,</span> <span class="s">'Eve Charge'</span><span class="p">,</span> <span class="s">'Night Calls'</span><span class="p">,</span>
       <span class="s">'Night Charge'</span><span class="p">,</span> <span class="s">'Intl Calls'</span><span class="p">,</span> <span class="s">'Intl Charge'</span><span class="p">,</span> <span class="s">'CustServ Calls'</span><span class="p">,</span>
       <span class="s">'AK'</span><span class="p">,</span> <span class="s">'AL'</span><span class="p">,</span> <span class="s">'AR'</span><span class="p">,</span> <span class="s">'AZ'</span><span class="p">,</span> <span class="s">'CA'</span><span class="p">,</span> <span class="s">'CO'</span><span class="p">,</span> <span class="s">'CT'</span><span class="p">,</span> <span class="s">'DC'</span><span class="p">,</span> <span class="s">'DE'</span><span class="p">,</span> <span class="s">'FL'</span><span class="p">,</span> <span class="s">'GA'</span><span class="p">,</span> <span class="s">'HI'</span><span class="p">,</span>
       <span class="s">'IA'</span><span class="p">,</span> <span class="s">'ID'</span><span class="p">,</span> <span class="s">'IL'</span><span class="p">,</span> <span class="s">'IN'</span><span class="p">,</span> <span class="s">'KS'</span><span class="p">,</span> <span class="s">'KY'</span><span class="p">,</span> <span class="s">'LA'</span><span class="p">,</span> <span class="s">'MA'</span><span class="p">,</span> <span class="s">'MD'</span><span class="p">,</span> <span class="s">'ME'</span><span class="p">,</span> <span class="s">'MI'</span><span class="p">,</span> <span class="s">'MN'</span><span class="p">,</span>
       <span class="s">'MO'</span><span class="p">,</span> <span class="s">'MS'</span><span class="p">,</span> <span class="s">'MT'</span><span class="p">,</span> <span class="s">'NC'</span><span class="p">,</span> <span class="s">'ND'</span><span class="p">,</span> <span class="s">'NE'</span><span class="p">,</span> <span class="s">'NH'</span><span class="p">,</span> <span class="s">'NJ'</span><span class="p">,</span> <span class="s">'NM'</span><span class="p">,</span> <span class="s">'NV'</span><span class="p">,</span> <span class="s">'NY'</span><span class="p">,</span> <span class="s">'OH'</span><span class="p">,</span>
       <span class="s">'OK'</span><span class="p">,</span> <span class="s">'OR'</span><span class="p">,</span> <span class="s">'PA'</span><span class="p">,</span> <span class="s">'RI'</span><span class="p">,</span> <span class="s">'SC'</span><span class="p">,</span> <span class="s">'SD'</span><span class="p">,</span> <span class="s">'TN'</span><span class="p">,</span> <span class="s">'TX'</span><span class="p">,</span> <span class="s">'UT'</span><span class="p">,</span> <span class="s">'VA'</span><span class="p">,</span> <span class="s">'VT'</span><span class="p">,</span> <span class="s">'WA'</span><span class="p">,</span>
       <span class="s">'WI'</span><span class="p">,</span> <span class="s">'WV'</span><span class="p">,</span> <span class="s">'WY'</span><span class="p">,</span><span class="s">'Churn?'</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">Index(['Account Length', 'Int'l Plan', 'VMail Plan', 'VMail Message',
       'Day Calls', 'Day Charge', 'Eve Calls', 'Eve Charge', 'Night Calls',
       'Night Charge', 'Intl Calls', 'Intl Charge', 'CustServ Calls', 'AK',
       'AL', 'AR', 'AZ', 'CA', 'CO', 'CT', 'DC', 'DE', 'FL', 'GA', 'HI', 'IA',
       'ID', 'IL', 'IN', 'KS', 'KY', 'LA', 'MA', 'MD', 'ME', 'MI', 'MN', 'MO',
       'MS', 'MT', 'NC', 'ND', 'NE', 'NH', 'NJ', 'NM', 'NV', 'NY', 'OH', 'OK',
       'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VA', 'VT', 'WA', 'WI',
       'WV', 'WY', 'Churn?'],
      dtype='object')
</code></pre></div>
<h2>Model Development</h2>

<p>Transforming the cleaned dataset into training and testing datasets, we can build the classifier by tuning the feature selector and estimator count with grid search. The weights are also redistributed to take into account the imbalance in the dataset.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()[:,</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="bp">True</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="bp">False</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()[:,</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">==</span> <span class="bp">True</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">==</span> <span class="bp">False</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">feature_selector</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span> <span class="k">if</span> <span class="n">y_train</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">))]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">wgt</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">]</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">IMLAdaBoostClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<span class="n">clf_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s">'feature_selector'</span><span class="p">,</span> <span class="n">feature_selector</span><span class="p">),</span> <span class="p">(</span><span class="s">'clf'</span><span class="p">,</span> <span class="n">clf</span><span class="p">)])</span>
<span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">feature_selector__k</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
              <span class="n">clf__n_estimators</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">175</span><span class="p">,</span><span class="mi">200</span><span class="p">])</span>
<span class="n">iml_clf</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">clf_pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">iml_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">iml_clf</span><span class="o">.</span><span class="n">best_estimator_</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">Pipeline(steps=[('feature_selector', SelectKBest(k=5, score_func=&lt;function f_classif at 0x000001B741D61BF8&gt;)), ('clf', IMLAdaBoostClassifier(n_estimators=100,
           weights=[0.00026150627615061507, 0.00026150627615061507, 0.00026150627615061507, 0.00026150627615061507, 0.00026150627615061507, 0.00026150...3, 0.0010460251046024603, 0.00026150627615061507, 0.00026150627615061507, 0.00026150627615061507]))])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span> <span class="p">(</span><span class="s">"score = "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iml_clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)))</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">iml_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">preds</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">score = 0.842578710645





array([[483,  87],
       [ 18,  79]])
</code></pre></div>
<p>The resulting classifier takes the top 5 features and applies 100 weak learners to develop the final classifier, with a classification score of 84%. The classifier over predicts the number of churn clients, while under estimating the non-churning clients. This is the desired result of the classifier, with the specification stating we are more concerned with identifying potential churn clients over predicting non-churning ones. </p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">feature_selector</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">AdaBoostClassifier</span><span class="p">()</span>
<span class="n">clf_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s">'feature_selector'</span><span class="p">,</span> <span class="n">feature_selector</span><span class="p">),</span> <span class="p">(</span><span class="s">'clf'</span><span class="p">,</span> <span class="n">clf</span><span class="p">)])</span>
<span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">feature_selector__k</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
              <span class="n">clf__n_estimators</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">175</span><span class="p">,</span><span class="mi">200</span><span class="p">])</span>
<span class="n">skl_clf</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">clf_pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">skl_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">skl_clf</span><span class="o">.</span><span class="n">best_estimator_</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">Pipeline(steps=[('feature_selector', SelectKBest(k=8, score_func=&lt;function f_classif at 0x000001B741D61BF8&gt;)), ('clf', AdaBoostClassifier(algorithm='SAMME.R', base_estimator=None,
          learning_rate=1.0, n_estimators=100, random_state=None))])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span> <span class="p">(</span><span class="s">"score = "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">skl_clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)))</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">skl_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">preds</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">score = 0.871064467766





array([[549,  21],
       [ 65,  32]])
</code></pre></div>
<p>When compared to the sklearn implementation of adaboost, the classifiers have similiar performance, with sklearn&#39;s classifier having 3% more classifcation accuracy. This gives confidence to the ability of our custom classifier to adequality classify real problems, but also indicates the existance of improvements we can embed into our classifier.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">iml_features</span> <span class="o">=</span> <span class="n">iml_clf</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s">'feature_selector'</span><span class="p">]</span><span class="o">.</span><span class="n">scores_</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">iml_top_features</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iml_features</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">iml_features</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">iml_top_features</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">Index(['Int'l Plan', 'CustServ Calls', 'Day Charge', 'VMail Plan',
       'Eve Charge', 'VMail Message', 'Intl Charge', 'TX', 'Intl Calls', 'MS'],
      dtype='object')
</code></pre></div>
<p>Reviewing the feature importance scores, we can see that the plan usage and calls to the service center are important features, along with a couple of states that show high rates of churn. This information could be used to target these specific attributes for improvement in the telcomunication product.</p>

<h2>Investment Plan</h2>

<p>With the developed classifier, we can use its prediction power to develop an investment decision planner for deciding whether to invest into retention plans for certain customers. The following script provides the tools to transform new customer data to be fed into the investment decider, which takes the cost of retention, expected return on retained customers and the probability of customer churn from the developed classifier, and returns the expect monetary return from the individual retention investment. If the return is positive, an investment to retain the customer is recommended.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">data_transforms</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">filtered_features</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Phone'</span><span class="p">,</span><span class="s">'Area Code'</span><span class="p">,</span><span class="s">'Day Mins'</span><span class="p">,</span> <span class="s">'Eve Mins'</span><span class="p">,</span> <span class="s">'Night Mins'</span><span class="p">,</span> <span class="s">'Intl Mins'</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">filtered_features</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s">'yes'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'no'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s">"Int'l Plan"</span><span class="p">:</span> <span class="n">mapping</span><span class="p">,</span> <span class="s">'VMail Plan'</span><span class="p">:</span> <span class="n">mapping</span><span class="p">})</span>
    <span class="n">state_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'State'</span><span class="p">]</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'State'</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">state_df</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Account Length'</span><span class="p">,</span> <span class="s">"Int'l Plan"</span><span class="p">,</span> <span class="s">'VMail Plan'</span><span class="p">,</span> <span class="s">'VMail Message'</span><span class="p">,</span>
       <span class="s">'Day Calls'</span><span class="p">,</span> <span class="s">'Day Charge'</span><span class="p">,</span> <span class="s">'Eve Calls'</span><span class="p">,</span> <span class="s">'Eve Charge'</span><span class="p">,</span> <span class="s">'Night Calls'</span><span class="p">,</span>
       <span class="s">'Night Charge'</span><span class="p">,</span> <span class="s">'Intl Calls'</span><span class="p">,</span> <span class="s">'Intl Charge'</span><span class="p">,</span> <span class="s">'CustServ Calls'</span><span class="p">,</span>
       <span class="s">'AK'</span><span class="p">,</span> <span class="s">'AL'</span><span class="p">,</span> <span class="s">'AR'</span><span class="p">,</span> <span class="s">'AZ'</span><span class="p">,</span> <span class="s">'CA'</span><span class="p">,</span> <span class="s">'CO'</span><span class="p">,</span> <span class="s">'CT'</span><span class="p">,</span> <span class="s">'DC'</span><span class="p">,</span> <span class="s">'DE'</span><span class="p">,</span> <span class="s">'FL'</span><span class="p">,</span> <span class="s">'GA'</span><span class="p">,</span> <span class="s">'HI'</span><span class="p">,</span>
       <span class="s">'IA'</span><span class="p">,</span> <span class="s">'ID'</span><span class="p">,</span> <span class="s">'IL'</span><span class="p">,</span> <span class="s">'IN'</span><span class="p">,</span> <span class="s">'KS'</span><span class="p">,</span> <span class="s">'KY'</span><span class="p">,</span> <span class="s">'LA'</span><span class="p">,</span> <span class="s">'MA'</span><span class="p">,</span> <span class="s">'MD'</span><span class="p">,</span> <span class="s">'ME'</span><span class="p">,</span> <span class="s">'MI'</span><span class="p">,</span> <span class="s">'MN'</span><span class="p">,</span>
       <span class="s">'MO'</span><span class="p">,</span> <span class="s">'MS'</span><span class="p">,</span> <span class="s">'MT'</span><span class="p">,</span> <span class="s">'NC'</span><span class="p">,</span> <span class="s">'ND'</span><span class="p">,</span> <span class="s">'NE'</span><span class="p">,</span> <span class="s">'NH'</span><span class="p">,</span> <span class="s">'NJ'</span><span class="p">,</span> <span class="s">'NM'</span><span class="p">,</span> <span class="s">'NV'</span><span class="p">,</span> <span class="s">'NY'</span><span class="p">,</span> <span class="s">'OH'</span><span class="p">,</span>
       <span class="s">'OK'</span><span class="p">,</span> <span class="s">'OR'</span><span class="p">,</span> <span class="s">'PA'</span><span class="p">,</span> <span class="s">'RI'</span><span class="p">,</span> <span class="s">'SC'</span><span class="p">,</span> <span class="s">'SD'</span><span class="p">,</span> <span class="s">'TN'</span><span class="p">,</span> <span class="s">'TX'</span><span class="p">,</span> <span class="s">'UT'</span><span class="p">,</span> <span class="s">'VA'</span><span class="p">,</span> <span class="s">'VT'</span><span class="p">,</span> <span class="s">'WA'</span><span class="p">,</span>
       <span class="s">'WI'</span><span class="p">,</span> <span class="s">'WV'</span><span class="p">,</span> <span class="s">'WY'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">df</span><span class="p">[</span><span class="n">cl</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">investment_decision</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span><span class="n">roi</span><span class="p">,</span><span class="n">customer_data</span><span class="p">):</span>
    <span class="n">inv_dec</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">churn_prob</span> <span class="o">=</span> <span class="n">iml_clf</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">customer_data</span><span class="p">)</span>  
    <span class="k">for</span> <span class="n">exp_churn</span> <span class="ow">in</span> <span class="n">churn_prob</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exp_churn</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">expected_return</span> <span class="o">=</span> <span class="o">-</span><span class="n">cost</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expected_return</span> <span class="o">=</span> <span class="p">(</span><span class="n">roi</span><span class="o">*</span><span class="n">exp_churn</span><span class="o">-</span><span class="n">cost</span><span class="p">)</span>
        <span class="n">inv_dec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expected_return</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">inv_dec</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"new_customers.csv"</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">data_transforms</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">rslt</span> <span class="o">=</span> <span class="n">investment_decision</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="n">df</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">cust</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rslt</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cust</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Invest in retain customer "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">Invest in retain customer 15
Invest in retain customer 198
Invest in retain customer 542
Invest in retain customer 546
Invest in retain customer 694
Invest in retain customer 974
Invest in retain customer 978
Invest in retain customer 985
Invest in retain customer 1192
Invest in retain customer 1407
Invest in retain customer 1472
Invest in retain customer 1610
Invest in retain customer 2076
Invest in retain customer 2614
Invest in retain customer 2660
Invest in retain customer 2732
Invest in retain customer 2786
Invest in retain customer 2942
Invest in retain customer 3322
</code></pre></div>
<h2>Future Work</h2>

<p>Through comparing our classifier with those implemented in sklearn, it&#39;s clear that some optimization exist for improvement, the most obvious being added intelligence in the decision stub thresholding and weak learner development. Other work will include the validation of our investment planner and its success at different levels of investment cost and expected customer returns.</p>

<h2>Bibliography</h2>

<p><a href="https://classroom.udacity.com/courses/ud675/lessons/367378584/concepts/3675485950923#">https://classroom.udacity.com/courses/ud675/lessons/367378584/concepts/3675485950923#</a><br>
<a href="http://scikit-learn.org/stable/documentation.html">http://scikit-learn.org/stable/documentation.html</a><br>
<a href="http://pandas.pydata.org/pandas-docs/stable/">http://pandas.pydata.org/pandas-docs/stable/</a><br>
<a href="http://seaborn.pydata.org/">http://seaborn.pydata.org/</a>  </p>

  </section>
  
</article>

<!-- Post navigation -->


<!-- Disqus -->


    		</div> <!-- #et-main-area -->
		</div> <!-- #page-container -->
		
<script src="/js/katex_init.js"></script>



<footer id="page-footer-trans" class="page-footer">
	<!--<p class="text"><a href="http://cole-maclean.github.io/">Cole MacLean</a>
</p>-->
	<p class="text">Hosted by <a href="https://github.com">GitHub</a>. Theme created by <a href="https://github.com/fengzhichu/fengzhichu-theme/tree/gh-pages">枫之楚</a></p>
</footer>


    
<!-- WP Audio player plugin v1.9.3 - https://www.tipsandtricks-hq.com/wordpress-audio-music-player-plugin-4556/ -->
    <script type="text/javascript">
        soundManager.useFlashBlock = true; // optional - if used, required flashblock.css
        soundManager.url = '/plugins/soundmanager2.swf';
        function play_mp3(flg, ids, mp3url, volume, loops)
        {
            //Check the file URL parameter value
            var pieces = mp3url.split("|");
            if (pieces.length > 1) {//We have got an .ogg file too
                mp3file = pieces[0];
                oggfile = pieces[1];
                //set the file URL to be an array with the mp3 and ogg file
                mp3url = new Array(mp3file, oggfile);
            }

            soundManager.createSound({
                id: 'btnplay_' + ids,
                volume: volume,
                url: mp3url
            });

            if (flg == 'play') {
                    soundManager.play('btnplay_' + ids, {
                    onfinish: function() {
                        if (loops == 'true') {
                            loopSound('btnplay_' + ids);
                        }
                        else {
                            document.getElementById('btnplay_' + ids).style.display = 'inline';
                            document.getElementById('btnstop_' + ids).style.display = 'none';
                        }
                    }
                });
            }
            else if (flg == 'stop') {
    //soundManager.stop('btnplay_'+ids);
                soundManager.pause('btnplay_' + ids);
            }
        }
        function show_hide(flag, ids)
        {
            if (flag == 'play') {
                document.getElementById('btnplay_' + ids).style.display = 'none';
                document.getElementById('btnstop_' + ids).style.display = 'inline';
            }
            else if (flag == 'stop') {
                document.getElementById('btnplay_' + ids).style.display = 'inline';
                document.getElementById('btnstop_' + ids).style.display = 'none';
            }
        }
        function loopSound(soundID)
        {
            window.setTimeout(function() {
                soundManager.play(soundID, {onfinish: function() {
                        loopSound(soundID);
                    }});
            }, 1);
        }
        function stop_all_tracks()
        {
            soundManager.stopAll();
            var inputs = document.getElementsByTagName("input");
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i].id.indexOf("btnplay_") == 0) {
                    inputs[i].style.display = 'inline';//Toggle the play button
                }
                if (inputs[i].id.indexOf("btnstop_") == 0) {
                    inputs[i].style.display = 'none';//Hide the stop button
                }
            }
        }
    </script>
    <script type='text/javascript' src="/js/frontend-builder-global-functions.js"></script>
<script type='text/javascript' src="/js/custom.js"></script>
<script type='text/javascript' src="/js/jquery.fitvids.js"></script>
<script type='text/javascript' src="/js/waypoints.min.js"></script>
<script type='text/javascript' src="/js/jquery.magnific-popup.js"></script>
<script type='text/javascript'>
/* <![CDATA[ */
var et_custom = {"ajaxurl":"http:\/\/blog.ibireme.com\/wp-admin\/admin-ajax.php","images_uri":"http:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/images","builder_images_uri":"http:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/includes\/builder\/images","et_load_nonce":"ae39988568","subscription_failed":"Please, check the fields below to make sure you entered the correct information.","fill":"Fill","field":"field","invalid":"Invalid email","captcha":"Captcha","prev":"Prev","previous":"\u4e0a\u4e00\u9875","next":"\u4e0b\u4e00\u9875","is_builder_plugin_used":""};
/* ]]> */
</script>
<script type='text/javascript' src="/js/frontend-builder-scripts.js"></script>
  </body>
</html>
