<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="zh-CN">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US" class="js">
<!--<![endif]-->
  

	
	    
	        
	    
	        
	    
	        
	    
	    
	

	
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	
<head>
	<meta charset="utf-8">
	<title>The Diagonality of Barcelona | Online Profile</title>
	<meta name="description" content=", Data Munging, Data Analysis, Barcelona, python, numpy, matplotlib, Data Munging and Analyzing Barcelona OSM Data">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-Frame-Options" content="sameorigin">
	<!-- CSS -->
	<link rel="stylesheet" href="/css/main.css">
	<link rel='stylesheet' id='divi-style-css'  href="/css/style.css" type='text/css' media='all' />
	<link rel="stylesheet" href="/css/post.style.css">

	<script type='text/javascript' src="/js/jquery.js"></script>
	<script type='text/javascript' src="/js/soundmanager2-nodebug-jsmin.js"></script>

	<!--Favicon-->
	<link rel="icon" href="favicon.ico" type="image/x-icon"/>
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	
	<link href="/favicon.ico" mce_href="favicon.ico" rel="bookmark" type="image/x-icon" /> 
	<link href="/favicon.ico" mce_href="favicon.ico" rel="icon" type="image/x-icon" /> 
	<link href="/favicon.ico" mce_href="favicon.ico" rel="shortcut icon" type="image/x-icon" /> 
	<!-- Canonical -->
	<link rel="canonical" href="http://cole-maclean.github.io//blog/The%20Diagonality%20of%20Barcelona/">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Online Profile" href="http://cole-maclean.github.io//feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	

	<!-- KaTeX -->
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.js"></script>
	

	<!-- Google Analytics -->
	
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-71787228-1', 'auto');
	ga('send', 'pageview');
	</script>
	

	<script type="text/javascript">
    var host = "http://cole-maclean.github.io/";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
    </script>
     <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-71787228-1', 'auto');
ga('send', 'pageview');

</script>
 
</head>

	<body class="home blog et_pb_button_helper_class home-posts et_fixed_nav et_show_nav et_cover_background et_pb_gutter windows et_pb_gutters3 et_primary_nav_dropdown_animation_fade et_secondary_nav_dropdown_animation_fade et_pb_footer_columns4 et_header_style_left et_right_sidebar chrome">
		<div id="page-container">
    		<header id="main-header" data-height-onload="66">
	<div class="container clearfix et_menu_container">
		<div class="logo_container">
			<span class="logo_helper"></span>
			<a href="/">
				<!--img src="http://blog.ibireme.com/wp-content/uploads/2015/05/logo1.png" alt="Garan no dou" id="logo" data-height-percentage="54" /-->
				Online Profile - Cole MacLean
			</a>
		</div>
		<div id="et-top-navigation" data-height="66" data-fixed-height="40">
			<nav id="top-menu-nav">
				<ul id="top-menu" class="nav">
					<li>
						<a class="page-link" href="/">
							Home
						</a>
					</li>
					
					
					
					
					<li>
						<a class="page-link" href="/projects/">
							Projects
						</a>
					</li>
					
					
					
					<li>
						<a class="page-link" href="/About/">
							About
						</a>
					</li>
					
					
					
					<li>
						<a class="page-link" href="/Archives/">
							Archive
						</a>
					</li>
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					<!-- Social icons from Font Awesome, if enabled -->
					<li>
						<a class="page-link" href="">Find Me</a>
						<ul class="children">












<li>
	<a href="https://github.com/cole-maclean" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>









<li>
	<a href="https://www.linkedin.com/in/macleancole" title="Follow on LinkedIn">
		<i class="fa fa-fw fa-linkedin"></i>
	</a>
</li>















<li>
	<a href="https://twitter.com/ponderingHplus" title="Follow on Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>







<li>
	<a href="https://www.kaggle.com/colemaclean" title="">
		<i>kaggle</i>
	</a>
</li>



<li>
	<a href="mailto:maclean.cole@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>

</ul>
					</li>
					
				</ul>
			</nav>

			<div id="et_mobile_nav_menu">
				<div class="mobile_nav closed">
					<span class="select_page"></span>
					<span class="mobile_menu_bar"></span>
				</div>
			</div>				
		</div> <!-- #et-top-navigation -->
	</div> <!-- .container -->
	<div class="et_search_outer">
		<div class="container et_search_form_container">
			<form role="search" method="get" class="et-search-form" action="http://cole-maclean.github.io/">
			<input type="search" class="et-search-field" placeholder="搜索 &hellip;" value="" name="s" title="搜索：" /></form>
			<span class="et_close_search_field"></span>
		</div>
	</div>
</header> <!-- #main-header -->

    		<div id="et-main-area">
      			

	
	    
	        
	    
	        
	    
	        
	    
	    
	

	
	    
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	                
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	            
	        
	        
	            
	            
	        
	    
	

<article >
  <header style="background-image: url('/')">

<!--article  >
  <div style="background-image: url('/')"/>
  <header style="background-image: url('')"-->
    <h1 class="title">The Diagonality of Barcelona</h1>
    <p id="subtitletrans" class="subtitlecontainer">
    <a class="subtitle">2015-09-20</a> | <a class = "subtittle" href=>HN</a>
	 <a class="subtitle"></a> <a class="subtitle">  <i class="fa fa-tags"></i>: <a href="/tags/data-munging/">Data Munging</a>, <a href="/tags/data-analysis/">Data Analysis</a>, <a href="/tags/barcelona/">Barcelona</a>, <a href="/tags/python/">python</a>, <a href="/tags/numpy/">numpy</a>, <a href="/tags/matplotlib/">matplotlib</a></a>
    </p>
  </header>
  <section class="post-content">
  <h2>Data Munging and Analyzing Barcelona OSM Data</h2>

<p>The XML data for the city boundary of Barcelona was downloaded from OSM to clean and transform into a json encodable structure to allow loading into MongoDB, providing storage and artbitrary querying to enable further data analysis of the Barcelona OSM dataset. I chose the Barcelona dataset because I just recently spent a few weeks there and noticed some pretty cool urban planning features of the city (ie. Avinguda Diagonal) that could be cool to explore further.</p>

<p>Inspired by the “Diagonality” of Barcelona streets and to give the scope of the project a little more focus, I will be attempting to analyze the Barcelona OSM data and see if I can generate a measure for the “degree of diagionality” for Barcelona and possibly compare this measure with other cities. Not knowing ahead of time the difficulty of this, I may eventually have to delete this previous sentence, but I’m interested enough to give it a shot.</p>

<p><img src="http://static1.squarespace.com/static/52b3aae6e4b00492bb71aa3d/t/54776cbde4b019f8929d0684/1414769949925/?format=1500w" /></p>

<p>From <a href="http://www.dailyoverview.com/six/">dailyoverview.com</a></p>

<h2>Imports and Data prep</h2>

<p>```python
%matplotlib inline
import xml.etree.cElementTree as ET
import pprint
import re
import codecs
import json
import math
import numpy as np
import matplotlib.pyplot as plt
import heapq</p>

<p>OSM_FILE = “C:/Users/Cole/Desktop/Udacity/Data Analyst Nano Degree/Project 3/barcelona_spain.osm”  # Replace this with your osm file
SAMPLE_FILE = “C:/Users/Cole/Desktop/Udacity/Data Analyst Nano Degree/Project 3/barcelona_spain_sample.osm”
def get_element(osm_file, tags=(‘node’, ‘way’, ‘relation’)):
    “"”Yield element if it is the right type of tag</p>

<pre><code>Reference:
http://stackoverflow.com/questions/3095434/inserting-newlines-in-xml-file-generated-via-xml-etree-elementtree-in-python
"""
context = ET.iterparse(osm_file, events=('start', 'end'))
_, root = next(context)
for event, elem in context:
    if event == 'end' and elem.tag in tags:
        yield elem
        root.clear()
</code></pre>

<p>with open(SAMPLE_FILE, ‘wb’) as output:
    output.write(‘<?xml version="1.0" encoding="UTF-8"?>\n’)
    output.write(‘<osm>\n  ')</osm></p>

<pre><code># Write every 100th top level element
for i, element in enumerate(get_element(OSM_FILE)):
    if i % 100 == 0:
        output.write(ET.tostring(element, encoding='utf-8'))

output.write('&lt;/osm&gt;')
</code></pre>

<p>```</p>

<p><b>Visual Data Inspection</b></p>

<p><code>python
#This code attempts to pick out unique data structures from the SAMPLE_FILE to give us examples of 
unique_elements = []
for i,element in enumerate(get_element(SAMPLE_FILE)):
    elem_children = [element.tag]
    for child in element.iter():
        elem_children.append(child.tag)
    if elem_children not in unique_elements:
        unique_elements.append(elem_children)
        #print ET.tostring(element, encoding='utf-8')
print (len(unique_elements))
</code></p>

<p>Reviewing the unique elements above yields a few considerations for potential data issues and facts pertinent to the goal of reporting a “degree of diagionality”:<br />
1. Being a Spanish City, the non-standard characters common in Spanish names might exist that could cause potential problems 
2. The amount of data for a given node or way varies. The minimum required data to enable calculation of a streets angle will need to be defined.
3. Nodes contain the required lat/lon coordinates required for calculating a ways angle<br />
4. Ways list the nodes that create the path of a street. This path may not be a straight line, which may have an impact on the angle calculation<br />
5. Not all ways have a street attribute, but still seem valid, such as examples that have a “highway” attribute</p>

<p><b>Data Shaping</b><br />
In order to perform a calculation of “diagonality” of a way, we need at least 2 nodes on the way that have lat/lon data. To ensure the way is a valid road to calculate diagionality on, the way must have one of: a valid steet or highway attribute. We will only keep top level data such as id, lat/lon and created data for nodes. To load this data into MongoDB for storage and querying, we need to shape this data into valid JSON, which the below code does.</p>

<p>```python
#Utility Regular Expressions
lower = re.compile(r’^([a-z]|<em>)*$’)
lower_colon = re.compile(r’^([a-z]|</em>)<em>:([a-z]|_)</em>$’)
problemchars = re.compile(r’[=+/&amp;&lt;&gt;;'”\?%#$@\,. \t\r\n]’)</p>

<h1 id="utility-data-structures-for-nested-dictslists">Utility data structures for nested dicts/lists</h1>
<p>TOP_LEVEL_DATA = [‘id’,’visible’]
CREATED = [ “version”, “changeset”, “timestamp”, “user”, “uid”]
POS=[‘lat’,’lon’]</p>

<h1 id="this-function-returns-a-data-dictionary-by-parsing-the-data-from-each-key-of-an-elements-attributes">This function returns a data dictionary by parsing the data from each key of an elements attributes</h1>
<p>#listed in the data_list argument
def data_dict(elem_attribs,data_list):
    return {data_elem:elem_attribs[data_elem] for data_elem in data_list if data_elem in elem_attribs.keys()} </p>

<p>def extract_top_level_data(element): # this function extract top level data from the elements attributes
    node = data_dict(element.attrib,TOP_LEVEL_DATA)
    created_dict = data_dict(element.attrib,CREATED)
    if created_dict:
        node[‘created’] = created_dict
    node[‘type’] = element.tag
    return node</p>

<p>def shape_element(element):
    node_refs = []
    if element.tag == “node”: #Checks if is node and extracts required data
       node = extract_top_level_data(element)
       for child in element.iter():
            pos_list = [float(child.attrib[pos_data]) for pos_data in POS if pos_data in child.attrib.keys()] #extracts lat/lon data in list and converts to float
            if pos_list:
                node[‘pos’] = pos_list
       return node
    elif element.tag == “way”: #Checks if is way and extracts required data
        node = extract_top_level_data(element)
        for child in element.iter():
            if child.tag ==’tag’:
                m = re.search(problemchars,child.attrib[‘k’]) #searches for problematic characters and returns None if encountered
                if m:
                    return None
                if child.attrib[‘k’] ==”addr:street”:#Checks if way has addr:street attribute and assigns the ‘street’ key the streets name, otherwise ‘highway’
                    node[‘street’] = child.attrib[‘v’]
                elif “highway” in child.attrib.values() and ‘street’ not in node.keys():
                    node[‘street’] = child.attrib[‘k’]
            if child.tag == ‘nd’:
                node_refs.append(child.attrib[‘ref’])
        if node_refs:
            node[“node_refs”] = node_refs
        else:
            return None
        if ‘street’ in node.keys() and len(node[‘node_refs’])&gt;=2: #Only return ways that have a addr:street or highway attribute and 2 or more node refs
            return node
        else:
            return None
    else:
        return None</p>

<p>def process_map(file_in, pretty = False):
    # You do not need to change this file
    file_out = “{0}.json”.format(file_in)
    data = []
    with codecs.open(file_out, “w”) as fo:
        for _, element in ET.iterparse(file_in):
            el = shape_element(element)
            if el:
                data.append(el)
        if pretty:
            fo.write(json.dumps(data, indent=2)+”\n”)
        else:
            fo.write(json.dumps(data) + “\n”)
    return data</p>

<p>process_map(OSM_FILE)
print “done”
```</p>

<pre><code>done
</code></pre>

<h2>Data Analysis</h2>
<p>Now that the data has been cleaned and converted to json, it is able to be stored into a MongoDB database and queried for analysis. Although we’ll use the full dataset that was cleaned and stored in analyzing the “degree of diagonality” of Barcelona, thus not requiring custom MongoDB queries, an example of a query if we were interesting in only ways that are highways would be:<br />
query_results = db.barca_OSM.find({“street”:”highway”})</p>

<p>```python
#Reference: Code from https://gist.github.com/jeromer/2005586
def calculate_initial_compass_bearing(pointA, pointB):
    “””
    Calculates the bearing between two points.
    The formulae used is the following:
        θ = atan2(sin(Δlong).cos(lat2),
                  cos(lat1).sin(lat2) − sin(lat1).cos(lat2).cos(Δlong))
    :Parameters:
      - <code>pointA: The tuple representing the latitude/longitude for the
        first point. Latitude and longitude must be in decimal degrees
      - </code>pointB: The tuple representing the latitude/longitude for the
        second point. Latitude and longitude must be in decimal degrees
    :Returns:
      The bearing in degrees
    :Returns Type:
      float
    “””
    if (type(pointA) != tuple) or (type(pointB) != tuple):
        raise TypeError(“Only tuples are supported as arguments”)</p>

<pre><code>lat1 = math.radians(pointA[0])
lat2 = math.radians(pointB[0])

diffLong = math.radians(pointB[1] - pointA[1])

x = math.sin(diffLong) * math.cos(lat2)
y = math.cos(lat1) * math.sin(lat2) - (math.sin(lat1)
        * math.cos(lat2) * math.cos(diffLong))

initial_bearing = math.atan2(x, y)

# Now we have the initial bearing but math.atan2 return values
# from -180° to + 180° which is not what we want for a compass bearing
# The solution is to normalize the initial bearing as shown below
initial_bearing = math.degrees(initial_bearing)
compass_bearing = (initial_bearing + 360) % 360

return compass_bearing ```
</code></pre>

<p>```python
degree_data = []
with open(“C:/Users/Cole/Desktop/Udacity/Data Analyst Nano Degree/Project 3/barcelona_spain.osm.json”,”r”) as data_file:
    data = json.load(data_file)
node_pos = {datum[‘id’]:datum[‘pos’] for i,datum in enumerate(data) if datum[‘type’]==’node’}
for indx,way_data in enumerate(data):
    if way_data[‘type’] == ‘way’:
        try:
            node_1_pos = tuple(node_pos[way_data[‘node_refs’][0]])
            node_2_pos = tuple(node_pos[way_data[‘node_refs’][1]])
            degree_data.append(calculate_initial_compass_bearing(node_1_pos,node_2_pos))
        except KeyError:
            pass
print degree_data[3:8]</p>

<p>```</p>

<pre><code>[267.85381820650105, 136.77552225283853, 225.17064639252413, 225.77167855473186, 169.69113420727763]
</code></pre>

<h2>Data Visualization</h2>
<p>With the street angle data, we can now generate a circular historgram plot across the street angles and visualize the most dominate directions of Barcelona streets.
Code adapted from <a href="http://stackoverflow.com/questions/22562364/circular-histogram-for-python">SO Circular Histogram for Python</a></p>

<p>```python
fig = plt.figure(figsize=(10, 12), dpi=100)
N = 36
hist, edges = np.histogram(degree_data, bins=N)
bottom = 8</p>

<p>theta = np.delete(edges,-1)
radii = hist
width = (2*np.pi) / N</p>

<p>ax = plt.subplot(111, polar=True)
bars = ax.bar(theta, radii, width=width, bottom=bottom)</p>

<h1 id="use-custom-colors-and-opacity">Use custom colors and opacity</h1>
<p>for r, bar in zip(radii, bars):
    bar.set_facecolor(plt.cm.jet(r / 10.))
    bar.set_alpha(0.8)
plt.show()
```</p>

<p><img src="/img/output_12_0.png" alt="png" /></p>

<h2>Final Analysis</h2>
<p>It appears there are 3 dominate street angles at around 135o, 255o and 5o. Using this visualization as a guide, we could develop a measure of diagonality as defined by taking 1 minus the count of the 2 most dominate angle’s and dividing that by the total count of the dataset. A perfectly non-diagonal city would result in a diagonality measure of (1-Count(dominant_angles))/(total_angles) = 0 where the 2 dominant angles are the only angles = total angles</p>

<p><code>python
dominant_angles = np.sum(heapq.nlargest(2, hist))
total_angles = np.sum(hist)
print "barcelona degree of diagonality =" + str(1-(float(dominant_angles)/float(total_angles)))
</code></p>

<pre><code>barcelona degree of diagonality =0.895038509762
</code></pre>

<h2>Final Conclusions</h2>
<p>The “degree of diagonality” of Barcelona using the above measure is 0.895. I intuitivley guess this is a relatively (globally speaking) high degree of diagonality, but other cities could be run through the above methodology and compared. I had alot of fun with the above analysis, and can think of many further areas to continue developing and errors to fix, but I have a Nano Degree to finish!</p>

  </section>
  
</article>

<!-- Post navigation -->


<!-- Disqus -->


    		</div> <!-- #et-main-area -->
		</div> <!-- #page-container -->
		
<script src="/js/katex_init.js"></script>



<footer id="page-footer-trans" class="page-footer">
	<!--<p class="text"><a href="http://cole-maclean.github.io/">Cole MacLean</a>
</p>-->
	<p class="text">Hosted by <a href="https://github.com">GitHub</a>. Theme created by <a href="https://github.com/fengzhichu/fengzhichu-theme/tree/gh-pages">枫之楚</a></p>
</footer>


    
<!-- WP Audio player plugin v1.9.3 - https://www.tipsandtricks-hq.com/wordpress-audio-music-player-plugin-4556/ -->
    <script type="text/javascript">
        soundManager.useFlashBlock = true; // optional - if used, required flashblock.css
        soundManager.url = '/plugins/soundmanager2.swf';
        function play_mp3(flg, ids, mp3url, volume, loops)
        {
            //Check the file URL parameter value
            var pieces = mp3url.split("|");
            if (pieces.length > 1) {//We have got an .ogg file too
                mp3file = pieces[0];
                oggfile = pieces[1];
                //set the file URL to be an array with the mp3 and ogg file
                mp3url = new Array(mp3file, oggfile);
            }

            soundManager.createSound({
                id: 'btnplay_' + ids,
                volume: volume,
                url: mp3url
            });

            if (flg == 'play') {
                    soundManager.play('btnplay_' + ids, {
                    onfinish: function() {
                        if (loops == 'true') {
                            loopSound('btnplay_' + ids);
                        }
                        else {
                            document.getElementById('btnplay_' + ids).style.display = 'inline';
                            document.getElementById('btnstop_' + ids).style.display = 'none';
                        }
                    }
                });
            }
            else if (flg == 'stop') {
    //soundManager.stop('btnplay_'+ids);
                soundManager.pause('btnplay_' + ids);
            }
        }
        function show_hide(flag, ids)
        {
            if (flag == 'play') {
                document.getElementById('btnplay_' + ids).style.display = 'none';
                document.getElementById('btnstop_' + ids).style.display = 'inline';
            }
            else if (flag == 'stop') {
                document.getElementById('btnplay_' + ids).style.display = 'inline';
                document.getElementById('btnstop_' + ids).style.display = 'none';
            }
        }
        function loopSound(soundID)
        {
            window.setTimeout(function() {
                soundManager.play(soundID, {onfinish: function() {
                        loopSound(soundID);
                    }});
            }, 1);
        }
        function stop_all_tracks()
        {
            soundManager.stopAll();
            var inputs = document.getElementsByTagName("input");
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i].id.indexOf("btnplay_") == 0) {
                    inputs[i].style.display = 'inline';//Toggle the play button
                }
                if (inputs[i].id.indexOf("btnstop_") == 0) {
                    inputs[i].style.display = 'none';//Hide the stop button
                }
            }
        }
    </script>
    <script type='text/javascript' src="/js/frontend-builder-global-functions.js"></script>
<script type='text/javascript' src="/js/custom.js"></script>
<script type='text/javascript' src="/js/jquery.fitvids.js"></script>
<script type='text/javascript' src="/js/waypoints.min.js"></script>
<script type='text/javascript' src="/js/jquery.magnific-popup.js"></script>
<script type='text/javascript'>
/* <![CDATA[ */
var et_custom = {"ajaxurl":"http:\/\/blog.ibireme.com\/wp-admin\/admin-ajax.php","images_uri":"http:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/images","builder_images_uri":"http:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/includes\/builder\/images","et_load_nonce":"ae39988568","subscription_failed":"Please, check the fields below to make sure you entered the correct information.","fill":"Fill","field":"field","invalid":"Invalid email","captcha":"Captcha","prev":"Prev","previous":"\u4e0a\u4e00\u9875","next":"\u4e0b\u4e00\u9875","is_builder_plugin_used":""};
/* ]]> */
</script>
<script type='text/javascript' src="/js/frontend-builder-scripts.js"></script>
  </body>
</html>
